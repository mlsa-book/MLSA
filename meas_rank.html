<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Raphael Sonabend and Andreas Bender">

<title>8&nbsp; Discrimination Measures – Machine Learning in Survival Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./meas_calib.html" rel="next">
<link href="./meas_what.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./meas_what.html">Evaluation</a></li><li class="breadcrumb-item"><a href="./meas_rank.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Discrimination Measures</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Machine Learning in Survival Analysis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mlsa-book/MLSA/tree/main/book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Machine-Learning-in-Survival-Analysis.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Symbols and Notation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Survival Analysis and Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">MLSA From Start to Finish</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machinelearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Statistical Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./eha.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Event-history Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survtsk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Survival Task</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Evaluation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meas_what.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">What are Survival Measures?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meas_rank.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Discrimination Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meas_calib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Calibration Measures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meas_rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Evaluating Distributions by Scoring Rules</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meas_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Evaluating Survival Time</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./meas_choosing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Choosing Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Classical Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./forests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Random Forests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Support Vector Machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boosting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Boosting Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./neuralnetworks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Neural Networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./models_choosing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Choosing Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Reduction Techniques</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reductions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Reductions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./competing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Competing Risks Pipelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discretetime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Discrete Time Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Connections to Poisson Regression and Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pseudo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Connections to Regression and Imputation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Conclusions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-eval-crank-disc-conc" id="toc-sec-eval-crank-disc-conc" class="nav-link active" data-scroll-target="#sec-eval-crank-disc-conc"><span class="header-section-number">8.1</span> Time-Independent Measures</a>
  <ul class="collapse">
  <li><a href="#concordance-indices" id="toc-concordance-indices" class="nav-link" data-scroll-target="#concordance-indices"><span class="header-section-number">8.1.1</span> Concordance Indices</a></li>
  <li><a href="#sec-eval-crank-choose" id="toc-sec-eval-crank-choose" class="nav-link" data-scroll-target="#sec-eval-crank-choose"><span class="header-section-number">8.1.2</span> Choosing a C-index</a></li>
  </ul></li>
  <li><a href="#sec-eval-crank-timedep" id="toc-sec-eval-crank-timedep" class="nav-link" data-scroll-target="#sec-eval-crank-timedep"><span class="header-section-number">8.2</span> Time-Dependent Measures</a>
  <ul class="collapse">
  <li><a href="#sec-eval-antolini" id="toc-sec-eval-antolini" class="nav-link" data-scroll-target="#sec-eval-antolini"><span class="header-section-number">8.2.1</span> Concordance Indices</a></li>
  <li><a href="#area-under-the-curve" id="toc-area-under-the-curve" class="nav-link" data-scroll-target="#area-under-the-curve"><span class="header-section-number">8.2.2</span> Area Under the Curve</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mlsa-book/MLSA/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/mlsa-book/MLSA/edit/main/book/meas_rank.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/mlsa-book/MLSA/blob/main/book/meas_rank.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./meas_what.html">Evaluation</a></li><li class="breadcrumb-item"><a href="./meas_rank.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Discrimination Measures</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-eval-crank" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Discrimination Measures</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    TODO (150-200 WORDS)
  </div>
</div>


</header>


<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Minor changes expected!
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>This page is a work in progress and minor changes will be made over time.</strong></p>
</div>
</div>
<p>The next measures discused are ‘discrimination measures’, which evaluate how well models separate observations into different risk groups. A model is said to have good discrimination if it correctly predicts that one observation is at higher risk of the event of interest than another, where the prediction is ‘correct’ if the observation predicted to be at higher risk does indeed experience the event sooner.</p>
<p>In the survival setting, the ‘risk’ is taken to be the continuous ranking prediction. All discrimination measures are ranking measures, which means that the exact predicted value is irrelevant, only its relative ordering is required. For example given predictions <span class="math inline">\(\{100,2,299.3\}\)</span>, only their rankings, <span class="math inline">\(\{2,1,3\}\)</span>, are used by measures of discrimination.</p>
<p>This chapter begins with time-independent measures (<a href="#sec-eval-crank-disc-conc" class="quarto-xref"><span>Section 8.1</span></a>), which measure concordance between pairs of observations at a single observed time point. The next section focuses on time-dependent measures (<a href="#sec-eval-crank-timedep" class="quarto-xref"><span>Section 8.2</span></a>), which are primarily AUC-type measures that evaluate discrimination over all possible unique time-points and integrate the results for a single metric.</p>
<section id="sec-eval-crank-disc-conc" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="sec-eval-crank-disc-conc"><span class="header-section-number">8.1</span> Time-Independent Measures</h2>
<p>The simplest form of discrimination measures are concordance indices, which, in general, measure the proportion of cases in which the model correctly ranks a pair of observations according to their risk. These measures may be best understood in terms of two key definitions: ‘comparable’, and ‘concordant’.</p>
<div id="def-concordance" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 8.1 (Concordance)</strong></span> Let <span class="math inline">\((i,j)\)</span> be a pair of observations with outcomes <span class="math inline">\(\{(t_i,\delta_i),(t_j,\delta_j)\}\)</span> and let <span class="math inline">\(r_i,r_j \in \mathbb{R}\)</span> be their respective risk predictions. Then <span class="math inline">\((i,j)\)</span> are called <span class="citation" data-cites="Harrell1984 Harrell1982">(<a href="references.html#ref-Harrell1984" role="doc-biblioref">F. E. J. Harrell et al. 1984</a>; <a href="references.html#ref-Harrell1982" role="doc-biblioref">F. E. Harrell, Califf, and Pryor 1982</a>)</span>:</p>
<ul>
<li><em>Comparable</em> if <span class="math inline">\(t_i &lt; t_j\)</span> and <span class="math inline">\(\delta_i = 1\)</span>;</li>
<li><em>Concordant</em> if <span class="math inline">\(r_i &gt; r_j\)</span>.</li>
</ul>
</div>
<p>Note that this book defines risk rankings such that a higher value implies higher risk of event and thus lower expected survival time (<a href="survtsk.html#sec-surv-set-types" class="quarto-xref"><span>Section 6.1</span></a>), hence a pair is concordant if <span class="math inline">\(\mathbb{I}(t_i &lt; t_j, r_i &gt; r_j)\)</span>. Other sources may instead assume that higher values imply lower risk of event and hence a pair would be concordant if <span class="math inline">\(\mathbb{I}(t_i &lt; t_j, r_i &lt; r_j)\)</span>.</p>
<p>Concordance measures then estimate the probability of a pair being concordant, given that they are comparable:</p>
<p><span class="math display">\[P(r_i &gt; r_j | t_i &lt; t_j \cap \delta_i)\]</span></p>
<p>These measures are referred to as time <em>independent</em> when <span class="math inline">\(r_i,r_j\)</span> is not a function of time as once the observations are organised into comparable pairs, the observed survival times can be ignored. The time-dependent case is covered in <a href="#sec-eval-antolini" class="quarto-xref"><span>Section 8.2.1</span></a>.</p>
<p>While various definitions of a ‘Concordance index’ (C-index) exist (discussed in the next section), they all represent a weighted proportion of the number of concordant pairs over the number of comparable pairs. As such, a C-index value will always be between <span class="math inline">\([0, 1]\)</span> with <span class="math inline">\(1\)</span> indicating perfect separation, <span class="math inline">\(0.5\)</span> indicating no separation, and <span class="math inline">\(0\)</span> being separation in the ‘wrong direction’, i.e.&nbsp;all high risk observations being ranked lower than all low risk observations.</p>
<p>Concordance measures may either be reported as a value in <span class="math inline">\([0,1]\)</span>, a percentage, or as ‘discriminatory power’, which refers to the percentage improvement of a model’s discrimination above the baseline value of <span class="math inline">\(0.5\)</span>. For example, if a model has a concordance of <span class="math inline">\(0.8\)</span> then its discriminatory power is <span class="math inline">\((0.8-0.5)/0.5 = 60\%\)</span>. This representation of discrimination provides more information by encoding the model’s improvement over some baseline although is often confused with reporting concordance as a percentage (e.g.&nbsp;reporting a concordance of 0.8 as 80%). In theory this representation could result in a negative value, however this would indicate that <span class="math inline">\(C&lt;0.5\)</span>, which would indicate serious problems with the model that should be addressed before proceeding with further analysis. Representing measures as a percentage over a baseline is a common method to improve measure interpretability and closely relates to the ERV representation of scoring rules.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🪧 Learn more about baseline comparison
</div>
</div>
<div class="callout-body-container callout-body">
<p>See <a href="meas_rules.html#sec-eval-distr-score-base" class="quarto-xref"><span>Section 10.4</span></a> to learn more about calculating measures with respect to an arbitrary baseline.</p>
</div>
</div>
<section id="concordance-indices" class="level3" data-number="8.1.1">
<h3 data-number="8.1.1" class="anchored" data-anchor-id="concordance-indices"><span class="header-section-number">8.1.1</span> Concordance Indices</h3>
<p>Common concordance indices in survival analysis can be expressed as a general measure:</p>
<p>Let <span class="math inline">\(\boldsymbol{\hat{r}} = ({\hat{r}}_1 \ {\hat{r}}_2 \cdots {\hat{r}}_{m})^\intercal\)</span> be predicted risks, <span class="math inline">\((\mathbf{t}, \boldsymbol{\delta}) = ((t_1, \delta_1) \ (t_2, \delta_2) \cdots (t_m, \delta_m))^\intercal\)</span> be observed outcomes, let <span class="math inline">\(W\)</span> be some weighting function, and let <span class="math inline">\(\tau\)</span> be a cut-off time. Then, the time-independent (‘ind’) <em>survival concordance index</em> is defined by,</p>
<p><span class="math display">\[
C_{ind}(\hat{\mathbf{r}}, \mathbf{t}, \boldsymbol{\delta}|\tau) = \frac{\sum_{i\neq j} W(t_i)\mathbb{I}(t_i &lt; t_j, \hat{r}_i &gt; \hat{r}_j, t_i &lt; \tau)\delta_i}{\sum_{i\neq j}W(t_i)\mathbb{I}(t_i &lt; t_j, t_i &lt; \tau)\delta_i}
\]</span></p>
<p>The choice of <span class="math inline">\(W\)</span> specifies a particular variation of the c-index (see below). The use of the cut-off <span class="math inline">\(\tau\)</span> mitigates against decreased sample size (and therefore high variance) over time due to the removal of censored observations (see <a href="#fig-ipcw" class="quarto-xref">Figure&nbsp;<span>8.1</span></a>)). For <span class="math inline">\(\tau\)</span> to be comparable across datasets, a common choice would be to set <span class="math inline">\(\tau\)</span> as the time at which 80%, or perhaps 90% of the data have been censored or experienced the event.</p>
<p>There are multiple methods for dealing with tied predictions and times. Strictly, tied times are incomparable given the definition of ‘comparable’ given above and hence are usually ignored in the numerator. On the other hand, ties in the prediction are more problematic but a common method is to set a value of <span class="math inline">\(0.5\)</span> for observations when <span class="math inline">\(r_i = r_j\)</span> <span class="citation" data-cites="Therneau2020">(<a href="references.html#ref-Therneau2020" role="doc-biblioref">Therneau and Atkinson 2020</a>)</span>. Specific concordance indices can be constructed by assigning a weighting scheme for <span class="math inline">\(W\)</span> which generally depends on the Kaplan-Meier estimate of the survival function of the censoring distribution fit on training data, <span class="math inline">\(\hat{G}_{KM}\)</span>, or the Kaplan-Meier estimate for the survival function of the survival distribution fit on training data, <span class="math inline">\(\hat{S}_{KM}\)</span>, or both. Measures that use <span class="math inline">\(\hat{G}_{KM}\)</span> are referred to as Inverse Probability of Censoring Weighted (IPCW) measures as the estimated censoring distribution is utilised to weight the measure in order to compensate for removed censored observations. This is visualised in <a href="#fig-ipcw" class="quarto-xref">Figure&nbsp;<span>8.1</span></a> where <span class="math inline">\(\hat{G}_{KM}\)</span>, <span class="math inline">\(\hat{G}_{KM}^{-2}\)</span>, and <span class="math inline">\(\hat{S}_{KM}\)</span> are computed based on the <code>whas</code> dataset <span class="citation" data-cites="dataapplied">(<a href="references.html#ref-dataapplied" role="doc-biblioref">Hosmer Jr, Lemeshow, and May 2011</a>)</span>.</p>
<div id="fig-ipcw" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Line graph with three lines in green, red, and blue. x-axis is labelled 't' and ranges from 0 to 6000. y-axis is labelled 'W(t)' and ranges from 0 to 5. Legend for lines is titled 'W' with entries 'KMG' for the red line, 'KMG^-2' for the green line, and 'KMS' for the blue line. The blue line starts at (0,1), moves to around (1000, 0.5) then is relatively flat. The red line roughly linearly decreases from (0,1) to (6000,0). The green line sharply increases between (1, 1000) to (5, 3500). A vertical gray line passes through (0, 1267).">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ipcw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/evaluation/weights.png" class="img-fluid figure-img" alt="Line graph with three lines in green, red, and blue. x-axis is labelled 't' and ranges from 0 to 6000. y-axis is labelled 'W(t)' and ranges from 0 to 5. Legend for lines is titled 'W' with entries 'KMG' for the red line, 'KMG^-2' for the green line, and 'KMS' for the blue line. The blue line starts at (0,1), moves to around (1000, 0.5) then is relatively flat. The red line roughly linearly decreases from (0,1) to (6000,0). The green line sharply increases between (1, 1000) to (5, 3500). A vertical gray line passes through (0, 1267).">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ipcw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.1: Weighting functions obtained on the <code>whas</code> dataset. x-axis is follow-up time. y-axis is outputs from one of three weighting functions: <span class="math inline">\(\hat{G}_{KM}\)</span>, survival function based on the censoring distribution of the <code>whas</code> dataset (red), and <span class="math inline">\(\hat{G}_{KM}^{-2}\)</span> (green), <span class="math inline">\(\hat{S}_{KM}\)</span>, marginal survival function based on original <code>whas</code> dataset (blue), . The vertical gray line at <span class="math inline">\(t = \tau=1267\)</span> represents the point at which <span class="math inline">\(\hat{G}(t)&lt;0.6\)</span>.
</figcaption>
</figure>
</div>
<p>The following weights have been proposed for the concordance index:</p>
<ul>
<li><span class="math inline">\(W(t_i) = 1\)</span>: Harrell’s concordance index, <span class="math inline">\(C_H\)</span> <span class="citation" data-cites="Harrell1984 Harrell1982">(<a href="references.html#ref-Harrell1984" role="doc-biblioref">F. E. J. Harrell et al. 1984</a>; <a href="references.html#ref-Harrell1982" role="doc-biblioref">F. E. Harrell, Califf, and Pryor 1982</a>)</span>, which is widely accepted to be the most common survival measure and imposes no weighting on the definition of concordance. The original measure given by Harrell has no cut-off, <span class="math inline">\(\tau = \infty\)</span>, however applying a cut-off is now more widely accepted in practice.</li>
<li><span class="math inline">\(W(t_i) = [\hat{G}_{KM}(t_i)]^{-2}\)</span>: Uno’s C, <span class="math inline">\(C_U\)</span> <span class="citation" data-cites="Uno2011">(<a href="references.html#ref-Uno2011" role="doc-biblioref">Uno et al. 2011</a>)</span>.</li>
<li><span class="math inline">\(W(t_i) = [\hat{G}_{KM}(t_i)]^{-1}\)</span></li>
<li><span class="math inline">\(W(t_i) = \hat{S}_{KM}(t_i)\)</span></li>
<li><span class="math inline">\(W(t_i) = \hat{S}_{KM}(t_i)/\hat{G}_{KM}(t_i)\)</span></li>
</ul>
<p>All methods assume that censoring is conditionally-independent of the event given the features (<span class="quarto-unresolved-ref">?sec-surv-set-cens</span>), otherwise weighting by <span class="math inline">\(\hat{S}_{KM}\)</span> or <span class="math inline">\(\hat{G}_{KM}\)</span> would not be applicable. It is assumed here that <span class="math inline">\(\hat{S}_{KM}\)</span> and <span class="math inline">\(\hat{G}_{KM}\)</span> are estimated on the training data and not the testing data (though the latter may be seen in some implementations, e.g. <span class="citation" data-cites="pkgsurvival">Therneau (<a href="references.html#ref-pkgsurvival" role="doc-biblioref">2015</a>)</span>).</p>
</section>
<section id="sec-eval-crank-choose" class="level3" data-number="8.1.2">
<h3 data-number="8.1.2" class="anchored" data-anchor-id="sec-eval-crank-choose"><span class="header-section-number">8.1.2</span> Choosing a C-index</h3>
<p>With multiple choices of weighting available, choosing a specific measure might seem daunting. Matters are only made worse by debate in the literature, reflecting uncertainty in measure choice and interpretation. In practice, when a suitable cut-of <span class="math inline">\(\tau\)</span> is chosen, all these weightings perform very similarly <span class="citation" data-cites="Rahman2017 Schmid2012">(<a href="references.html#ref-Rahman2017" role="doc-biblioref">Rahman et al. 2017</a>; <a href="references.html#ref-Schmid2012" role="doc-biblioref">Schmid and Potapov 2012</a>)</span>. For example, <a href="#tbl-ipcw" class="quarto-xref">Table&nbsp;<span>8.1</span></a> uses the <code>whas</code> data again to compare Harrell’s C with measures that include IPCW weighting, when no cutoff is applied (top row) and when a cutoff is applied when <span class="math inline">\(\hat{G}(t)=0.6\)</span> (grey line in <a href="#fig-ipcw" class="quarto-xref">Figure&nbsp;<span>8.1</span></a>). The results are almost identical when the cutoff is applied but still not massively different without the cutoff.</p>
<!-- results below from _experiments.R -->
<div id="tbl-ipcw" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ipcw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.1: Comparing C-index measures (calculated on the <code>whas</code> dataset using a Cox model with three-fold cross-validation) with no cut-off (top) and a cut-off when <span class="math inline">\(\hat{G}(t)=0.6\)</span> (bottom). First column is Harrell’s C, second is the weighting <span class="math inline">\(1/\hat{G}(t)\)</span>, third is Uno’s C.
</figcaption>
<div aria-describedby="tbl-ipcw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th><span class="math inline">\(W=1\)</span></th>
<th><span class="math inline">\(W= G^{-1}\)</span></th>
<th><span class="math inline">\(W=G^{-2}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\tau=\infty\)</span></td>
<td>0.74</td>
<td>0.73</td>
<td>0.71</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\tau=1267\)</span></td>
<td>0.76</td>
<td>0.75</td>
<td>0.75</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>On the other hand, if a poor choice is selected for <span class="math inline">\(\tau\)</span> (cutting off too late) then IPCW measures can be highly unstable <span class="citation" data-cites="Rahman2017">(<a href="references.html#ref-Rahman2017" role="doc-biblioref">Rahman et al. 2017</a>)</span>, for example the variance of Uno’s C drastically increases with increased censoring <span class="citation" data-cites="Schmid2012">(<a href="references.html#ref-Schmid2012" role="doc-biblioref">Schmid and Potapov 2012</a>)</span>.</p>
<p>In practice, all C-index metrics provide an intuitive measure of discrimination and as such the choice of C-index is less important than the transparency in reporting. ‘C-hacking’ <span class="citation" data-cites="Sonabend2022">(<a href="references.html#ref-Sonabend2022" role="doc-biblioref">R. Sonabend, Bender, and Vollmer 2022</a>)</span> is the deliberate, unethical procedure of calculating multiple C-indices and to selectively report one or more results to promote a particular model or result, whilst ignoring any negative findings. For example, calculating Harrell’s C and Uno’s C but only reporting the measure that shows a particular model of interest is better than another (even if the other metric shows the reverse effect). To avoid ‘C-hacking’:</p>
<ol type="i">
<li>the choice of C-index should be made before experiments have begun and the choice of C-index should be clearly reported;</li>
<li>when ranking predictions are composed from distribution predictions, the composition method should be chosen and clearly described before experiments have begun.</li>
</ol>
<p>As the C-index is highly dependent on censoring within a dataset, C-index values between experiments are not directly comparable, instead comparisons are limited to comparing model rankings, for example conclusions such as “model A outperformed model B with respect to Harrell’s C in this experiment”.</p>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
🪧 Learn about distribution to ranking compositions.
</div>
</div>
<div class="callout-body-container callout-body">
<p>See <a href="reductions.html#sec-car-pipelines" class="quarto-xref"><span>Section 19.4</span></a> to learn more about creating ranking predictions from distribution predictions using composition.</p>
</div>
</div>
</section>
</section>
<section id="sec-eval-crank-timedep" class="level2 page-columns page-full" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="sec-eval-crank-timedep"><span class="header-section-number">8.2</span> Time-Dependent Measures</h2>
<p>In the time-dependent case, where the metrics are computed based on specific survival times, the majority of measures are based on the Area Under the Curve, with one exception which is a simpler concordance index.</p>
<section id="sec-eval-antolini" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="sec-eval-antolini"><span class="header-section-number">8.2.1</span> Concordance Indices</h3>
<p>In contrast to the measures described above, Antolini’s C <span class="citation" data-cites="Antolini2005">(<a href="references.html#ref-Antolini2005" role="doc-biblioref">Antolini, Boracchi, and Biganzoli 2005</a>)</span> provides a time-dependent (‘dep’) formula for the concordance index. The definition of ‘comparable’ is the same for Antolini’s C, however, concordance is now determined using the individual predicted survival probabilities calculated at the smaller event time in the pair:</p>
<p><span class="math display">\[P(\hat{S}_i(t_i) &lt; \hat{S}_j(t_i) | t_i &lt; t_j \cap \delta_i)\]</span></p>
<p>Note that observations are concordant when <span class="math inline">\(\hat{S}_i(t_i) &lt; \hat{S}_j(t_i)\)</span> as at the time <span class="math inline">\(t_i\)</span>, observation <span class="math inline">\(i\)</span> has experienced the event and observation <span class="math inline">\(j\)</span> has not, hence the expected survival probability for <span class="math inline">\(\hat{S}_i(t_i)\)</span> should be as close to 0 as possible (noting inherent randomness may prevent the perfect <span class="math inline">\(\hat{S}_i(t_i)=0\)</span> prediction) but otherwise should be less than <span class="math inline">\(\hat{S}_j(t_i)\)</span> as <span class="math inline">\(j\)</span> is still ‘alive’. Once again this probability is estimated with a metric that could include a cut-off and different weighting schemes (though this is not included in Antolini’s original definition):</p>
<p><span class="math display">\[
C_{dep}(\hat{\mathbf{S}}, \mathbf{t}, \boldsymbol{\delta}|\tau) = \frac{\sum_{i\neq j} W(t_i)\mathbb{I}(t_i &lt; t_j, \hat{S}_i(t_i) &lt; \hat{S}_j(t_i), t_i &lt; \tau)\delta_i}{\sum_{i\neq j}W(t_i)\mathbb{I}(t_i &lt; t_j, t_i &lt; \tau)\delta_i}
\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\hat{S}} = ({\hat{S}}_1 \ {\hat{S}}_2 \cdots {\hat{S}}_{m})^\intercal\)</span>.</p>
<p>Antolini’s C provides an intuitive method to evaluate the discrimination of a model based on distribution predictions without depending on compositions to ranking predictions.</p>
</section>
<section id="area-under-the-curve" class="level3 page-columns page-full" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="area-under-the-curve"><span class="header-section-number">8.2.2</span> Area Under the Curve</h3>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>We are still discussing how to structure and write this section so the contents are all subject to change. The text below is ‘correct’ but we want to add more detail about estimation of AUC so the book can be more practical, otherwise we may remove the section completely, let us know your thoughts about what you’d like to see here!</p>
</div>
</div>
<p>AUC, or AUROC, measures calculate the Area Under the Receiver Operating Characteristic (ROC) Curve, which is a plot of the <em>sensitivity</em> (or true positive rate (TPR)) against <span class="math inline">\(1 - \textit{specificity}\)</span> (or true negative rate (TNR)) at varying thresholds (described below) for the predicted probability (or risk) of event. <a href="#fig-eval-rocs" class="quarto-xref">Figure&nbsp;<span>8.2</span></a> visualises ROC curves for two classification models. The blue line is a featureless baseline that has no discrimination. The red line is a decision tree with better discrimination as it comes closer to the top-left corner.</p>
<div id="fig-eval-rocs" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Image shows graph with '1 - Specificity' on the x-axis from 0 to 1 and 'Sensitivity' on the y-axis from 0 to 1. There is a blue line from the bottom left (0,0) to the top right (1,1) of the graph and a red line that forms a curve from (0,0) to around (0.2,0.8) then (1,1).">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-eval-rocs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/evaluation/rocs.png" class="img-fluid figure-img" alt="Image shows graph with '1 - Specificity' on the x-axis from 0 to 1 and 'Sensitivity' on the y-axis from 0 to 1. There is a blue line from the bottom left (0,0) to the top right (1,1) of the graph and a red line that forms a curve from (0,0) to around (0.2,0.8) then (1,1).">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-eval-rocs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.2: ROC Curves for a classification example. Red is a decision tree with good discrimination as it ‘hugs’ the top-left corner. Blue is a featureless baseline with no discrimination as it sits on <span class="math inline">\(y = x\)</span>.
</figcaption>
</figure>
</div>
<p>In a classification setting with no censoring, the AUC has the same interpretation as Harrell’s C <span class="citation" data-cites="Uno2011">(<a href="references.html#ref-Uno2011" role="doc-biblioref">Uno et al. 2011</a>)</span>. AUC measures for survival analysis were developed to provide a time-dependent measure of discriminatory ability <span class="citation" data-cites="Heagerty2000">(<a href="references.html#ref-Heagerty2000" role="doc-biblioref">Patrick J. Heagerty, Lumley, and Pepe 2000</a>)</span>. In a survival setting it can reasonably be expected for a model to perform differently over time and therefore time-dependent measures are advantageous. Computation of AUC estimators is complex and as such there are limited accessible metrics available off-shelf. There is limited evidence of these estimators used in the literature, hence discussion of these measures is kept brief.</p>
<p>The AUC, TPR, and TNR are derived from the <em>confusion matrix</em> in a binary classification setting. Let <span class="math inline">\(b_i,\hat{b}_i \in \{0, 1\}\)</span> be the true and predicted binary outcomes respectively for some observation <span class="math inline">\(i\)</span>. The confusion matrix is then given by:</p>
<table class="caption-top table">
<tbody>
<tr class="odd">
<td></td>
<td><span class="math inline">\(b_i = 1\)</span></td>
<td><span class="math inline">\(b_i = 0\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(\hat{b}_i = 1\)</span></td>
<td>TP</td>
<td>FP</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\hat{b}_i = 0\)</span></td>
<td>FN</td>
<td>TN</td>
</tr>
</tbody>
</table>
<p>where <span class="math inline">\(TN := \sum_i \mathbb{I}(b_i = 0, \hat{b}_i = 0)\)</span> is the number of true negatives, <span class="math inline">\(TP := \sum_i \mathbb{I}(b_i = 1, \hat{b}_i = 1)\)</span> is the number true positives, <span class="math inline">\(FP := \sum_i \mathbb{I}(b_i = 0, \hat{b}_i = 1)\)</span> is the number of false positives, and <span class="math inline">\(FN := \sum_i \mathbb{I}(b_i = 1, \hat{b}_i = 0)\)</span> is the number of false negatives. From these are derived</p>
<p><span class="math display">\[\begin{align}
&amp; TPR := \frac{TP}{TP + FN} \\
&amp; TNR := \frac{TN}{TN + FP}
\end{align}\]</span></p>
<p>In classification, a probabilistic prediction of an event can be <em>thresholded</em> to obtain a deterministic prediction. For a predicted <span class="math inline">\(\hat{p} := \hat{P}(b = 1)\)</span>, and threshold <span class="math inline">\(\alpha\)</span>, the thresholded binary prediction is <span class="math inline">\(\hat{b} := \mathbb{I}(\hat{p} &gt; \alpha)\)</span>. This is achieved in survival analysis by thresholding the linear predictor at a given time for different values of the threshold and different values of the time. All measures of TPR, TNR and AUC are in the range <span class="math inline">\([0,1]\)</span> with larger values preferred.</p>
<p>Weighting the linear predictor was proposed by Uno <span class="math inline">\(\textit{et al.}\)</span> (2007) <span class="citation" data-cites="Uno2007">(<a href="references.html#ref-Uno2007" role="doc-biblioref">Uno et al. 2007</a>)</span> and provides a method for estimating TPR and TNR via</p>
<p><span class="math display">\[
\begin{split}
&amp;TPR_U(\boldsymbol{\hat{\eta}}, \mathbf{t}, \boldsymbol{\delta}| \tau, \alpha) =  \frac{\sum^m_{i=1} \delta_i \mathbb{I}(k(\hat{\eta}_i) &gt; \alpha, t_i \leq \tau)[\hat{G}_{KM}(t_i)]^{-1}}{\sum^m_{i=1}\delta_i\mathbb{I}(t_i \leq \tau)[\hat{G}_{KM}(t_i)]^{-1}}
\end{split}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\begin{split}
&amp;TNR_U(\boldsymbol{\hat{\eta}}, \mathbf{t}| \tau, \alpha) \mapsto \frac{\sum^m_{i=1} \mathbb{I}(k(\hat{\eta}_i) \leq \alpha, t_i &gt; \tau)}{\sum^m_{i=1}\mathbb{I}(t_i &gt; \tau)}
\end{split}
\]</span> where <span class="math inline">\(\boldsymbol{\hat{\eta}} = ({\hat{\eta}}_1 \ {\hat{\eta}}_2 \cdots {\hat{\eta}}_{m})^\intercal\)</span> is a vector of predicted linear predictors, <span class="math inline">\(\tau\)</span> is the time at which to evaluate the measure, <span class="math inline">\(\alpha\)</span> is a cut-off for the linear predictor, and <span class="math inline">\(k\)</span> is a known, strictly increasing, differentiable function. <span class="math inline">\(k\)</span> is chosen depending on the model choice, for example if the fitted model is PH then <span class="math inline">\(k(x) = 1 - \exp(-\exp(x))\)</span> <span class="citation" data-cites="Uno2007">(<a href="references.html#ref-Uno2007" role="doc-biblioref">Uno et al. 2007</a>)</span>. Similarities can be drawn between these equations and Uno’s concordance index, in particular the use of IPCW. Censoring is again assumed to be at least random once conditioned on features. Plotting <span class="math inline">\(TPR_U\)</span> against <span class="math inline">\(1 - TNR_U\)</span> for varying values of <span class="math inline">\(\alpha\)</span> provides the ROC.</p>
<p>The second method, which appears to be more prominent in the literature, is derived from Heagerty and Zheng (2005) <span class="citation" data-cites="Heagerty2005">(<a href="references.html#ref-Heagerty2005" role="doc-biblioref">Patrick J. Heagerty and Zheng 2005</a>)</span>. They define four distinct classes, in which observations are split into controls and cases.</p>
<p>An observation is a <em>case</em> at a given time-point if they are dead, otherwise they are a <em>control</em>. These definitions imply that all observations begin as controls and (hypothetically) become cases over time. Cases are then split into <em>incident</em> or <em>cumulative</em> and controls are split into <em>static</em> or <em>dynamic</em>. The choice between modelling static or dynamic controls is dependent on the question of interest. Modelling static controls implies that a ‘subject does not change disease status’ <span class="citation" data-cites="Heagerty2005">(<a href="references.html#ref-Heagerty2005" role="doc-biblioref">Patrick J. Heagerty and Zheng 2005</a>)</span>, and few methods have been developed for this setting <span class="citation" data-cites="Kamarudin2017">(<a href="references.html#ref-Kamarudin2017" role="doc-biblioref">Kamarudin, Cox, and Kolamunnage-Dona 2017</a>)</span>, as such the focus here is on <em>dynamic</em> controls. The incident/cumulative cases choice is discussed in more detail below.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;All measures discussed in this section evaluate model discrimination from ‘markers’, which may be a <em>predictive</em> marker (model predictions) or a <em>prognostic</em> marker (a single covariate). This section always defines a marker as a ranking prediction, which is valid for all measures discussed here with the exception of one given at the end.</p></div></div><p>The TNR for dynamic cases is defined as</p>
<p><span class="math display">\[
TNR_D(\hat{\mathbf{r}}, N | \alpha, \tau) = P(\hat{r}_i \leq \alpha | N_i(\tau) = 0)
\]</span> where <span class="math inline">\(\boldsymbol{\hat{r}} = ({\hat{r}}_1 \ {\hat{r}}_2 \cdots {\hat{r}}_{n})^\intercal\)</span> is some deterministic prediction and <span class="math inline">\(N(\tau)\)</span> is a count of the number of events in <span class="math inline">\([0,\tau)\)</span>. Heagerty and Zheng further specify <span class="math inline">\(y\)</span> to be the predicted linear predictor <span class="math inline">\(\hat{\eta}\)</span>. Cumulative/dynamic and incident/dynamic measures are available in software packages ‘off-shelf’, these are respectively defined by</p>
<p><span class="math display">\[
TPR_C(\hat{\mathbf{r}}, N | \alpha, \tau) = P(\hat{r}_i &gt; \alpha | N_i(\tau) = 1)
\]</span> and</p>
<p><span class="math display">\[
TPR_I(\hat{\mathbf{r}}, N | \alpha, \tau) = P(\hat{r}_i &gt; \alpha | dN_i(\tau) = 1)
\]</span> where <span class="math inline">\(dN_i(\tau) = N_i(\tau) - N_i(\tau-)\)</span>. Practical estimation of these quantities is not discussed here.</p>
<p>The choice between the incident/dynamic (I/D) and cumulative/dynamic (C/D) measures primarily relates to the use-case. The C/D measures are preferred if a specific time-point is of interest <span class="citation" data-cites="Heagerty2005">(<a href="references.html#ref-Heagerty2005" role="doc-biblioref">Patrick J. Heagerty and Zheng 2005</a>)</span> and is implemented in several applications for this purpose <span class="citation" data-cites="Kamarudin2017">(<a href="references.html#ref-Kamarudin2017" role="doc-biblioref">Kamarudin, Cox, and Kolamunnage-Dona 2017</a>)</span>. The I/D measures are preferred when the true survival time is known and discrimination is desired at the given event time <span class="citation" data-cites="Heagerty2005">(<a href="references.html#ref-Heagerty2005" role="doc-biblioref">Patrick J. Heagerty and Zheng 2005</a>)</span>.</p>
<p>Defining a time-specific AUC is now possible with</p>
<p><span class="math display">\[
AUC(\hat{\mathbf{r}}, N | \tau) = \int^1_0 TPR(\hat{\mathbf{r}}, N | 1 - TNR^{-1}(p|\tau), \tau) \ dp
\]</span></p>
<p>Finally, integrating over all time-points produces a time-dependent AUC and as usual a cut-off is applied for the upper limit,</p>
<p><span class="math display">\[
AUC^*(\hat{\mathbf{r}},N|\tau^*) = \int^{\tau^*}_0 AUC(\hat{\mathbf{r}},N|\tau)\frac{2\hat{p}_{KM}(\tau)\hat{S}_{KM}(\tau)}{1 - \hat{S}_{KM}^2(\tau^*)} \ d\tau
\]</span> where <span class="math inline">\(\hat{S}_{KM},\hat{p}_{KM}\)</span> are survival and mass functions estimated with a Kaplan-Meier model on training data.</p>
<p>Since Heagerty and Zheng’s paper, other methods for calculating the time-dependent AUC have been devised, including by Chambless and Diao <span class="citation" data-cites="Chambless2006">(<a href="references.html#ref-Chambless2006" role="doc-biblioref">Chambless and Diao 2006</a>)</span>, Song and Zhou <span class="citation" data-cites="Song2008">(<a href="references.html#ref-Song2008" role="doc-biblioref">Song and Zhou 2008</a>)</span>, and Hung and Chiang <span class="citation" data-cites="Hung2010">(<a href="references.html#ref-Hung2010" role="doc-biblioref">Hung and Chiang 2010</a>)</span>. These either stem from the Heagerty and Zheng paper or ignore the case/control distinction and derive the AUC via different estimation methods of TPR and TNR. Blanche <span class="math inline">\(\textit{et al.}\)</span> (2012) <span class="citation" data-cites="Blanche2012">(<a href="references.html#ref-Blanche2012" role="doc-biblioref">Blanche, Latouche, and Viallon 2012</a>)</span> surveyed these and concluded ‘’regarding the choice of the retained definition for cases and controls, no clear guidance has really emerged in the literature’‘, but agree with Heagerty and Zeng on the use of C/D for clinical trials and I/D for ’pure’ evaluation of the marker. Blanche <span class="math inline">\(\textit{et al.}\)</span> (2013) <span class="citation" data-cites="Blanche2013">(<a href="references.html#ref-Blanche2013" role="doc-biblioref">Blanche, Dartigues, and Jacqmin-Gadda 2013</a>)</span> published a survey of C/D AUC measures with an emphasis on non-parametric estimators with marker-dependent censoring, including their own Conditional IPCW (CIPCW) AUC, which is not discussed further here as it cannot be used for evaluating predictions <span class="citation" data-cites="Sonabend2021b">(<a href="references.html#ref-Sonabend2021b" role="doc-biblioref">R. E. B. Sonabend 2021</a>)</span>.</p>
<p>Reviews of AUC measures have produced (sometimes markedly) different results <span class="citation" data-cites="Blanche2012 Li2018 Kamarudin2017">(<a href="references.html#ref-Blanche2012" role="doc-biblioref">Blanche, Latouche, and Viallon 2012</a>; <a href="references.html#ref-Li2018" role="doc-biblioref">Li, Greene, and Hu 2018</a>; <a href="references.html#ref-Kamarudin2017" role="doc-biblioref">Kamarudin, Cox, and Kolamunnage-Dona 2017</a>)</span> with no clear consensus on how and when these measures should be used. The primary advantage of these measures is to extend discrimination metrics to be time-dependent. However, it is unclear how to interpret a threshold of a linear predictor and moreover if this is even the ‘correct’ quantity to threshold, especially when survival distribution predictions are the more natural object to evaluate over time.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Antolini2005" class="csl-entry" role="listitem">
Antolini, Laura, Patrizia Boracchi, and Elia Biganzoli. 2005. <span>“<span class="nocase">A time-dependent discrimination index for survival data</span>.”</span> <em>Statistics in Medicine</em> 24 (24): 3927–44. <a href="https://doi.org/10.1002/sim.2427">https://doi.org/10.1002/sim.2427</a>.
</div>
<div id="ref-Blanche2013" class="csl-entry" role="listitem">
Blanche, Paul, Jean-François Dartigues, and Hélène Jacqmin-Gadda. 2013. <span>“<span class="nocase">Review and comparison of ROC curve estimators for a time-dependent outcome with marker-dependent censoring</span>.”</span> <em>Biometrical Journal</em> 55 (5): 687–704. <a href="https://doi.org/10.1002/bimj.201200045">https://doi.org/10.1002/bimj.201200045</a>.
</div>
<div id="ref-Blanche2012" class="csl-entry" role="listitem">
Blanche, Paul, Aurélien Latouche, and Vivian Viallon. 2012. <span>“<span class="nocase">Time-dependent AUC with right-censored data: a survey study</span>,”</span> October. <a href="https://doi.org/10.1007/978-1-4614-8981-8_11">https://doi.org/10.1007/978-1-4614-8981-8_11</a>.
</div>
<div id="ref-Chambless2006" class="csl-entry" role="listitem">
Chambless, Lloyd E, and Guoqing Diao. 2006. <span>“<span class="nocase">Estimation of time-dependent area under the ROC curve for long-term risk prediction</span>.”</span> <em>Statistics in Medicine</em> 25 (20): 3474–86. <a href="https://doi.org/10.1002/sim.2299">https://doi.org/10.1002/sim.2299</a>.
</div>
<div id="ref-Harrell1984" class="csl-entry" role="listitem">
Harrell, F E Jr, K L Lee, R M Califf, D B Pryor, and R A Rosati. 1984. <span>“<span class="nocase">Regression modelling strategies for improved prognostic prediction.</span>”</span> <em>Statistics in Medicine</em> 3 (2): 143–52. <a href="https://doi.org/10.1002/sim.4780030207">https://doi.org/10.1002/sim.4780030207</a>.
</div>
<div id="ref-Harrell1982" class="csl-entry" role="listitem">
Harrell, Frank E., Robert M. Califf, and David B. Pryor. 1982. <span>“<span class="nocase">Evaluating the yield of medical tests</span>.”</span> <em>JAMA</em> 247 (18): 2543–46. <a href="http://dx.doi.org/10.1001/jama.1982.03320430047030">http://dx.doi.org/10.1001/jama.1982.03320430047030</a>.
</div>
<div id="ref-Heagerty2000" class="csl-entry" role="listitem">
Heagerty, Patrick J., Thomas Lumley, and Margaret S. Pepe. 2000. <span>“<span class="nocase">Time-Dependent ROC Curves for Censored Survival Data and a Diagnostic Marker</span>.”</span> <em>Biometrics</em> 56 (2): 337–44. <a href="https://doi.org/10.1111/j.0006-341X.2000.00337.x">https://doi.org/10.1111/j.0006-341X.2000.00337.x</a>.
</div>
<div id="ref-Heagerty2005" class="csl-entry" role="listitem">
Heagerty, Patrick J, and Yingye Zheng. 2005. <span>“<span class="nocase">Survival Model Predictive Accuracy and ROC Curves</span>.”</span> <em>Biometrics</em> 61 (1): 92–105. <a href="https://doi.org/10.1111/j.0006-341X.2005.030814.x">https://doi.org/10.1111/j.0006-341X.2005.030814.x</a>.
</div>
<div id="ref-dataapplied" class="csl-entry" role="listitem">
Hosmer Jr, David W, Stanley Lemeshow, and Susanne May. 2011. <em><span class="nocase">Applied survival analysis: regression modeling of time-to-event data</span></em>. Vol. 618. John Wiley &amp; Sons.
</div>
<div id="ref-Hung2010" class="csl-entry" role="listitem">
Hung, Hung, and Chin-Tsang Chiang. 2010. <span>“<span class="nocase">Estimation methods for time-dependent AUC models with survival data</span>.”</span> <em>The Canadian Journal of Statistics / La Revue Canadienne de Statistique</em> 38 (1): 8–26. <a href="http://www.jstor.org/stable/27805213">http://www.jstor.org/stable/27805213</a>.
</div>
<div id="ref-Kamarudin2017" class="csl-entry" role="listitem">
Kamarudin, Adina Najwa, Trevor Cox, and Ruwanthi Kolamunnage-Dona. 2017. <span>“<span class="nocase">Time-dependent ROC curve analysis in medical research: Current methods and applications</span>.”</span> <em>BMC Medical Research Methodology</em> 17 (1): 1–19. <a href="https://doi.org/10.1186/s12874-017-0332-6">https://doi.org/10.1186/s12874-017-0332-6</a>.
</div>
<div id="ref-Li2018" class="csl-entry" role="listitem">
Li, Liang, Tom Greene, and Bo Hu. 2018. <span>“<span class="nocase">A simple method to estimate the time-dependent receiver operating characteristic curve and the area under the curve with right censored data</span>.”</span> <em>Statistical Methods in Medical Research</em> 27 (8): 2264–78. <a href="https://doi.org/10.1177/0962280216680239">https://doi.org/10.1177/0962280216680239</a>.
</div>
<div id="ref-Rahman2017" class="csl-entry" role="listitem">
Rahman, M. Shafiqur, Gareth Ambler, Babak Choodari-Oskooei, and Rumana Z. Omar. 2017. <span>“<span class="nocase">Review and evaluation of performance measures for survival prediction models in external validation settings</span>.”</span> <em>BMC Medical Research Methodology</em> 17 (1): 1–15. <a href="https://doi.org/10.1186/s12874-017-0336-2">https://doi.org/10.1186/s12874-017-0336-2</a>.
</div>
<div id="ref-Schmid2012" class="csl-entry" role="listitem">
Schmid, Matthias, and Sergej Potapov. 2012. <span>“<span class="nocase">A comparison of estimators to evaluate the discriminatory power of time-to-event models</span>.”</span> <em>Statistics in Medicine</em> 31 (23): 2588–2609. <a href="https://doi.org/10.1002/sim.5464">https://doi.org/10.1002/sim.5464</a>.
</div>
<div id="ref-Sonabend2021b" class="csl-entry" role="listitem">
Sonabend, Raphael Edward Benjamin. 2021. <span>“<span class="nocase">A Theoretical and Methodological Framework for Machine Learning in Survival Analysis: Enabling Transparent and Accessible Predictive Modelling on Right-Censored Time-to-Event Data</span>.”</span> PhD, University College London (UCL). <a href="https://discovery.ucl.ac.uk/id/eprint/10129352/">https://discovery.ucl.ac.uk/id/eprint/10129352/</a>.
</div>
<div id="ref-Sonabend2022" class="csl-entry" role="listitem">
Sonabend, Raphael, Andreas Bender, and Sebastian Vollmer. 2022. <span>“<span class="nocase">Avoiding C-hacking when evaluating survival distribution predictions with discrimination measures</span>.”</span> Edited by Zhiyong Lu. <em>Bioinformatics</em> 38 (17): 4178–84. <a href="https://doi.org/10.1093/bioinformatics/btac451">https://doi.org/10.1093/bioinformatics/btac451</a>.
</div>
<div id="ref-Song2008" class="csl-entry" role="listitem">
Song, Xiao, and Xiao-Hua Zhou. 2008. <span>“<span class="nocase">A semiparametric approach for the covariate specific ROC curve with survival outcome</span>.”</span> <em>Statistica Sinica</em> 18 (July): 947–65.
</div>
<div id="ref-pkgsurvival" class="csl-entry" role="listitem">
Therneau, Terry M. 2015. <span>“<span class="nocase">A Package for Survival Analysis in S</span>.”</span> <a href="https://cran.r-project.org/package=survival">https://cran.r-project.org/package=survival</a>.
</div>
<div id="ref-Therneau2020" class="csl-entry" role="listitem">
Therneau, Terry M., and Elizabeth Atkinson. 2020. <span>“<span>Concordance</span>.”</span> <a href="https://cran.r-project.org/web/packages/survival/vignettes/concordance.pdf">https://cran.r-project.org/web/packages/survival/vignettes/concordance.pdf</a>.
</div>
<div id="ref-Uno2011" class="csl-entry" role="listitem">
Uno, Hajime, Tianxi Cai, Michael J. Pencina, Ralph B. D’Agostino, and L J Wei. 2011. <span>“<span class="nocase">On the C-statistics for Evaluating Overall Adequacy of Risk Prediction Procedures with Censored Survival Data</span>.”</span> <em>Statistics in Medicine</em> 30 (10): 1105–17. <a href="https://doi.org/10.1002/sim.4154">https://doi.org/10.1002/sim.4154</a>.
</div>
<div id="ref-Uno2007" class="csl-entry" role="listitem">
Uno, Hajime, Tianxi Cai, Lu Tian, and L J Wei. 2007. <span>“<span class="nocase">Evaluating Prediction Rules for t-Year Survivors with Censored Regression Models</span>.”</span> <em>Journal of the American Statistical Association</em> 102 (478): 527–37. <a href="http://www.jstor.org/stable/27639883">http://www.jstor.org/stable/27639883</a>.
</div>
</div>
</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./meas_what.html" class="pagination-link" aria-label="What are Survival Measures?">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">What are Survival Measures?</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./meas_calib.html" class="pagination-link" aria-label="Calibration Measures">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Calibration Measures</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> TODO (150-200 WORDS)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>{{&lt; include _setup.qmd &gt;}}</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Discrimination Measures {#sec-eval-crank}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>{{&lt; include _wip_minor.qmd &gt;}}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>The next measures discused are 'discrimination measures', which evaluate how well models separate observations into different risk groups.</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>A model is said to have good discrimination if it correctly predicts that one observation is at higher risk of the event of interest than another, where the prediction is 'correct' if the observation predicted to be at higher risk does indeed experience the event sooner.</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>In the survival setting, the 'risk' is taken to be the continuous ranking prediction.</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>All discrimination measures are ranking measures, which means that the exact predicted value is irrelevant, only its relative ordering is required.</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>For example given predictions $<span class="sc">\{</span>100,2,299.3<span class="sc">\}</span>$, only their rankings, $<span class="sc">\{</span>2,1,3<span class="sc">\}</span>$, are used by measures of discrimination.</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>This chapter begins with time-independent measures (@sec-eval-crank-disc-conc), which measure concordance between pairs of observations at a single observed time point.</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>The next section focuses on time-dependent measures (@sec-eval-crank-timedep), which are primarily AUC-type measures that evaluate discrimination over all possible unique time-points and integrate the results for a single metric.</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time-Independent Measures {#sec-eval-crank-disc-conc}</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>The simplest form of discrimination measures are concordance indices, which, in general, measure the proportion of cases in which the model correctly ranks a pair of observations according to their risk.</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>These measures may be best understood in terms of two key definitions: 'comparable', and 'concordant'.</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>::: {#def-concordance}</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Concordance</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>Let $(i,j)$ be a pair of observations with outcomes $<span class="sc">\{</span>(t_i,\delta_i),(t_j,\delta_j)<span class="sc">\}</span>$ and let $r_i,r_j \in \Reals$ be their respective risk predictions. Then $(i,j)$ are called <span class="co">[</span><span class="ot">@Harrell1984; @Harrell1982</span><span class="co">]</span>:</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*Comparable* if $t_i &lt; t_j$ and $\delta_i = 1$;</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*Concordant* if $r_i &gt; r_j$.</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>Note that this book defines risk rankings such that a higher value implies higher risk of event and thus lower expected survival time (@sec-surv-set-types), hence a pair is concordant if $\II(t_i &lt; t_j, r_i &gt; r_j)$.</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>Other sources may instead assume that higher values imply lower risk of event and hence a pair would be concordant if $\II(t_i &lt; t_j, r_i &lt; r_j)$.</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>Concordance measures then estimate the probability of a pair being concordant, given that they are comparable:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>$$P(r_i &gt; r_j | t_i &lt; t_j \cap \delta_i)$$</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>These measures are referred to as time *independent* when $r_i,r_j$ is not a function of time as once the observations are organised into comparable pairs, the observed survival times can be ignored.</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>The time-dependent case is covered in @sec-eval-antolini.</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>While various definitions of a 'Concordance index' (C-index) exist (discussed in the next section), they all represent a weighted proportion of the number of concordant pairs over the number of comparable pairs.</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>As such, a C-index value will always be between $<span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>$ with $1$ indicating perfect separation, $0.5$ indicating no separation, and $0$ being separation in the 'wrong direction', i.e. all high risk observations being ranked lower than all low risk observations.</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>Concordance measures may either be reported as a value in $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$, a percentage, or as 'discriminatory power', which refers to the percentage improvement of a model's discrimination above the baseline value of $0.5$.</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>For example, if a model has a concordance of $0.8$ then its discriminatory power is $(0.8-0.5)/0.5 = 60\%$.</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>This representation of discrimination provides more information by encoding the model's improvement over some baseline although is often confused with reporting concordance as a percentage (e.g. reporting a concordance of 0.8 as 80%).</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>In theory this representation could result in a negative value, however this would indicate that $C&lt;0.5$, which would indicate serious problems with the model that should be addressed before proceeding with further analysis.</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>Representing measures as a percentage over a baseline is a common method to improve measure interpretability and closely relates to the ERV representation of scoring rules.</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE,warning=FALSE,message=FALSE}</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="in">learn("sec-eval-distr-score-base", "calculating measures with respect to an arbitrary baseline", ttl_fmt = "Learn more about baseline comparison")</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### Concordance Indices</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>Common concordance indices in survival analysis can be expressed as a general measure:</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>Let $\dvec{\hatr}{m}$ be predicted risks, $(\tt, \dd) = ((t_1, \delta_1) \ (t_2, \delta_2) \cdots (t_m, \delta_m))^\trans$ be observed outcomes, let $W$ be some weighting function, and let $\tau$ be a cut-off time.</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>Then, the time-independent ('ind') *survival concordance index* is defined by,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>C_{ind}(\hatrr, \tt, \dd|\tau) = \frac{\sum_{i\neq j} W(t_i)\II(t_i &lt; t_j, \hatr_i &gt; \hatr_j, t_i &lt; \tau)\delta_i}{\sum_{i\neq j}W(t_i)\II(t_i &lt; t_j, t_i &lt; \tau)\delta_i}</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>The choice of $W$ specifies a particular variation of the c-index (see below).</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>The use of the cut-off $\tau$ mitigates against decreased sample size (and therefore high variance) over time due to the removal of censored observations (see @fig-ipcw)).</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>For $\tau$ to be comparable across datasets, a common choice would be to set $\tau$ as the time at which 80\%, or perhaps 90\% of the data have been censored or experienced the event.</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>There are multiple methods for dealing with tied predictions and times.</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>Strictly, tied times are incomparable given the definition of 'comparable' given above and hence are usually ignored in the numerator.</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>On the other hand, ties in the prediction are more problematic but a common method is to set a value of $0.5$ for observations when $r_i = r_j$ <span class="co">[</span><span class="ot">@Therneau2020</span><span class="co">]</span>.</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>Specific concordance indices can be constructed by assigning a weighting scheme for $W$ which generally depends on the Kaplan-Meier estimate of the survival function of the censoring distribution fit on training data, $\KMG$, or the Kaplan-Meier estimate for the survival function of the survival distribution fit on training data, $\KMS$, or both.</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>Measures that use $\KMG$ are referred to as Inverse Probability of Censoring Weighted (IPCW) measures as the estimated censoring distribution is utilised to weight the measure in order to compensate for removed censored observations.</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>This is visualised in @fig-ipcw where $\KMG$, $\KMG^{-2}$, and $\KMS$ are computed based on the <span class="in">`whas`</span> dataset <span class="co">[</span><span class="ot">@dataapplied</span><span class="co">]</span>.</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="al">![Weighting functions obtained on the `whas` dataset. x-axis is follow-up time. y-axis is outputs from one of three weighting functions: $\KMG$, survival function based on the censoring distribution of the `whas` dataset (red), and $\KMG^{-2}$ (green), $\KMS$, marginal survival function based on original `whas` dataset (blue), . The vertical gray line at $t = \tau=1267$ represents the point at which $\hatG(t)&lt;0.6$.](Figures/evaluation/weights.png)</span>{#fig-ipcw fig-alt="Line graph with three lines in green, red, and blue. x-axis is labelled 't' and ranges from 0 to 6000. y-axis is labelled 'W(t)' and ranges from 0 to 5. Legend for lines is titled 'W' with entries 'KMG' for the red line, 'KMG^-2' for the green line, and 'KMS' for the blue line. The blue line starts at (0,1), moves to around (1000, 0.5) then is relatively flat. The red line roughly linearly decreases from (0,1) to (6000,0). The green line sharply increases between (1, 1000) to (5, 3500). A vertical gray line passes through (0, 1267)."}</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>The following weights have been proposed for the concordance index:</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$W(t_i) = 1$:  Harrell's concordance index, $C_H$ <span class="co">[</span><span class="ot">@Harrell1984; @Harrell1982</span><span class="co">]</span>, which is widely accepted to be the most common survival measure and imposes no weighting on the definition of concordance. The original measure given by Harrell has no cut-off, $\tau = \infty$, however applying a cut-off is now more widely accepted in practice.</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$W(t_i) = <span class="co">[</span><span class="ot">\KMG(t_i)</span><span class="co">]</span>^{-2}$: Uno's C, $C_U$ <span class="co">[</span><span class="ot">@Uno2011</span><span class="co">]</span>.</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$W(t_i) = <span class="co">[</span><span class="ot">\KMG(t_i)</span><span class="co">]</span>^{-1}$</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$W(t_i) = \KMS(t_i)$</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$W(t_i) = \KMS(t_i)/\KMG(t_i)$</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>All methods assume that censoring is conditionally-independent of the event given the features (@sec-surv-set-cens), otherwise weighting by $\KMS$ or $\KMG$ would not be applicable. It is assumed here that $\KMS$ and $\KMG$ are estimated on the training data and not the testing data (though the latter may be seen in some implementations, e.g. @pkgsurvival).</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a><span class="fu">### Choosing a C-index {#sec-eval-crank-choose}</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>With multiple choices of weighting available, choosing a specific measure might seem daunting.</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>Matters are only made worse by debate in the literature, reflecting uncertainty in measure choice and interpretation.</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>In practice, when a suitable cut-of $\tau$ is chosen, all these weightings perform very similarly <span class="co">[</span><span class="ot">@Rahman2017; @Schmid2012</span><span class="co">]</span>.</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>For example, @tbl-ipcw uses the <span class="in">`whas`</span> data again to compare Harrell's C with measures that include IPCW weighting, when no cutoff is applied (top row) and when a cutoff is applied when $\hat{G}(t)=0.6$ (grey line in @fig-ipcw).</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>The results are almost identical when the cutoff is applied but still not massively different without the cutoff.</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- results below from _experiments.R --&gt;</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>| | $W=1$ | $W= G^{-1}$ | $W=G^{-2}$ |</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>|-|-|-|-|</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>| $\tau=\infty$ | 0.74 | 0.73 | 0.71 |</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>| $\tau=1267$ | 0.76 | 0.75 | 0.75 |</span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>: Comparing C-index measures (calculated on the <span class="in">`whas`</span> dataset using a Cox model with three-fold cross-validation) with no cut-off (top) and a cut-off when $\hat{G}(t)=0.6$ (bottom). First column is Harrell's C, second is the weighting $1/\hat{G}(t)$, third is Uno's C. {#tbl-ipcw}</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>On the other hand, if a poor choice is selected for $\tau$ (cutting off too late) then IPCW measures can be highly unstable <span class="co">[</span><span class="ot">@Rahman2017</span><span class="co">]</span>, for example the variance of Uno's C drastically increases with increased censoring <span class="co">[</span><span class="ot">@Schmid2012</span><span class="co">]</span>.</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>In practice, all C-index metrics provide an intuitive measure of discrimination and as such the choice of C-index is less important than the transparency in reporting.</span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>'C-hacking' <span class="co">[</span><span class="ot">@Sonabend2022</span><span class="co">]</span> is the deliberate, unethical procedure of calculating multiple C-indices and to selectively report one or more results to promote a particular model or result, whilst ignoring any negative findings.</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>For example, calculating Harrell's C and Uno's C but only reporting the measure that shows a particular model of interest is better than another (even if the other metric shows the reverse effect).</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>To avoid 'C-hacking':</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>i) the choice of C-index should be made before experiments have begun and the choice of C-index should be clearly reported;</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>ii) when ranking predictions are composed from distribution predictions, the composition method should be chosen and clearly described before experiments have begun.</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>As the C-index is highly dependent on censoring within a dataset, C-index values between experiments are not directly comparable, instead comparisons are limited to comparing model rankings, for example conclusions such as "model A outperformed model B with respect to Harrell's C in this experiment".</span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE, warning=FALSE}</span></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a><span class="in">learn("sec-car-pipelines", "creating ranking predictions from distribution predictions using composition", ttl_fmt = "Learn about distribution to ranking compositions.")</span></span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a><span class="fu">## Time-Dependent Measures {#sec-eval-crank-timedep}</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>In the time-dependent case, where the metrics are computed based on specific survival times, the majority of measures are based on the Area Under the Curve, with one exception which is a simpler concordance index.</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a><span class="fu">### Concordance Indices {#sec-eval-antolini}</span></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>In contrast to the measures described above, Antolini's C <span class="co">[</span><span class="ot">@Antolini2005</span><span class="co">]</span> provides a time-dependent ('dep') formula for the concordance index.</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>The definition of 'comparable' is the same for Antolini's C, however, concordance is now determined using the individual predicted survival probabilities calculated at the smaller event time in the pair:</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>$$P(\hatS_i(t_i) &lt; \hatS_j(t_i) | t_i &lt; t_j \cap \delta_i)$$</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>Note that observations are concordant when $\hatS_i(t_i) &lt; \hatS_j(t_i)$ as at the time $t_i$, observation $i$ has experienced the event and observation $j$ has not, hence the expected survival probability for $\hatS_i(t_i)$ should be as close to 0 as possible (noting inherent randomness may prevent the perfect $\hatS_i(t_i)=0$ prediction) but otherwise should be less than $\hatS_j(t_i)$ as $j$ is still 'alive'.</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>Once again this probability is estimated with a metric that could include a cut-off and different weighting schemes (though this is not included in Antolini's original definition):</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>C_{dep}(\hatSS, \tt, \dd|\tau) = \frac{\sum_{i\neq j} W(t_i)\II(t_i &lt; t_j, \hatS_i(t_i) &lt; \hatS_j(t_i), t_i &lt; \tau)\delta_i}{\sum_{i\neq j}W(t_i)\II(t_i &lt; t_j, t_i &lt; \tau)\delta_i}</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>where $\dvec{\hatS}{m}$.</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>Antolini's C provides an intuitive method to evaluate the discrimination of a model based on distribution predictions without depending on compositions to ranking predictions.</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a><span class="fu">### Area Under the Curve</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>We are still discussing how to structure and write this section so the contents are all subject to change.</span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>The text below is 'correct' but we want to add more detail about estimation of AUC so the book can be more practical, otherwise we may remove the section completely, let us know your thoughts about what you'd like to see here!</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>AUC, or AUROC, measures calculate the Area Under the Receiver Operating Characteristic (ROC) Curve, which is a plot of the *sensitivity* (or true positive rate (TPR)) against $1 - \textit{specificity}$ (or true negative rate (TNR)) at varying thresholds (described below) for the predicted probability (or risk) of event.</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>@fig-eval-rocs visualises ROC curves for two classification models.</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>The blue line is a featureless baseline that has no discrimination.</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>The red line is a decision tree with better discrimination as it comes closer to the top-left corner.</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a><span class="al">![ROC Curves for a classification example. Red is a decision tree with good discrimination as it 'hugs' the top-left corner. Blue is a featureless baseline with no discrimination as it sits on $y = x$.](Figures/evaluation/rocs.png)</span>{#fig-eval-rocs fig-alt="Image shows graph with '1 - Specificity' on the x-axis from 0 to 1 and 'Sensitivity' on the y-axis from 0 to 1. There is a blue line from the bottom left (0,0) to the top right (1,1) of the graph and a red line that forms a curve from (0,0) to around (0.2,0.8) then (1,1)."}</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>In a classification setting with no censoring, the AUC has the same interpretation as Harrell's C <span class="co">[</span><span class="ot">@Uno2011</span><span class="co">]</span>.</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>AUC measures for survival analysis were developed to provide a time-dependent measure of discriminatory ability <span class="co">[</span><span class="ot">@Heagerty2000</span><span class="co">]</span>.</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>In a survival setting it can reasonably be expected for a model to perform differently over time and therefore time-dependent measures are advantageous.</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>Computation of AUC estimators is complex and as such there are limited accessible metrics available off-shelf.</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>There is limited evidence of these estimators used in the literature, hence discussion of these measures is kept brief.</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>The AUC, TPR, and TNR are derived from the *confusion matrix* in a binary classification setting.</span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>Let $b_i,\hatb_i \in <span class="sc">\{</span>0, 1<span class="sc">\}</span>$ be the true and predicted binary outcomes respectively for some observation $i$.</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>The confusion matrix is then given by:</span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>||||</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>|----|----|-----|</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>| | $b_i = 1$ | $b_i = 0$ |</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>| $\hatb_i = 1$ | TP | FP |</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>| $\hatb_i = 0$ | FN | TN |</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>where $TN := \sum_i \II(b_i = 0, \hatb_i = 0)$ is the number of true negatives, $TP := \sum_i \II(b_i = 1, \hatb_i = 1)$ is the number true positives, $FP := \sum_i \II(b_i = 0, \hatb_i = 1)$ is the number of false positives, and $FN := \sum_i \II(b_i = 1, \hatb_i = 0)$ is the number of false negatives.</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>From these are derived</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>\begin{align}</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>&amp; TPR := \frac{TP}{TP + FN} <span class="sc">\\</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>&amp; TNR := \frac{TN}{TN + FP}</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>\end{align}</span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>In classification, a probabilistic prediction of an event can be *thresholded* to obtain a deterministic prediction.</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>For a predicted $\hat{p} := \hat{P}(b = 1)$, and threshold $\alpha$, the thresholded binary prediction is $\hat{b} := \II(\hat{p} &gt; \alpha)$.</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>This is achieved in survival analysis by thresholding the linear predictor at a given time for different values of the threshold and different values of the time.</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>All measures of TPR, TNR and AUC are in the range $<span class="co">[</span><span class="ot">0,1</span><span class="co">]</span>$ with larger values preferred.</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>Weighting the linear predictor was proposed by Uno $\etal$ (2007) <span class="co">[</span><span class="ot">@Uno2007</span><span class="co">]</span> and provides a method for estimating TPR and TNR via</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>\begin{split}</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>&amp;TPR_U(\hatee, \tt, \dd | \tau, \alpha) =  \frac{\sum^m_{i=1} \delta_i \II(k(\hat{\eta}_i) &gt; \alpha, t_i \leq \tau)[\KMG(t_i)]^{-1}}{\sum^m_{i=1}\delta_i\II(t_i \leq \tau)<span class="co">[</span><span class="ot">\KMG(t_i)</span><span class="co">]</span>^{-1}}</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>\end{split}</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>\begin{split}</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>&amp;TNR_U(\hatee, \tt | \tau, \alpha) \mapsto \frac{\sum^m_{i=1} \II(k(\hat{\eta}_i) \leq \alpha, t_i &gt; \tau)}{\sum^m_{i=1}\II(t_i &gt; \tau)}</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>\end{split}</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>where $\dvec{\hateta}{m}$ is a vector of predicted linear predictors, $\tau$ is the time at which to evaluate the measure, $\alpha$ is a cut-off for the linear predictor, and $k$ is a known, strictly increasing, differentiable function. $k$ is chosen depending on the model choice, for example if the fitted model is PH then $k(x) = 1 - \exp(-\exp(x))$ <span class="co">[</span><span class="ot">@Uno2007</span><span class="co">]</span>. Similarities can be drawn between these equations and Uno's concordance index, in particular the use of IPCW. Censoring is again assumed to be at least random once conditioned on features. Plotting $TPR_U$ against $1 - TNR_U$ for varying values of $\alpha$ provides the ROC.</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>The second method, which appears to be more prominent in the literature, is derived from Heagerty and Zheng (2005) <span class="co">[</span><span class="ot">@Heagerty2005</span><span class="co">]</span>. They define four distinct classes, in which observations are split into controls and cases.</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>An observation is a *case* at a given time-point if they are dead, otherwise they are a *control*. These definitions imply that all observations begin as controls and (hypothetically) become cases over time. Cases are then split into *incident* or *cumulative* and controls are split into *static* or *dynamic*. The choice between modelling static or dynamic controls is dependent on the question of interest. Modelling static controls implies that a 'subject does not change disease status' [@Heagerty2005], and few methods have been developed for this setting [@Kamarudin2017], as such the focus here is on *dynamic* controls. The incident/cumulative cases choice is discussed in more detail below.^[All measures discussed in this section evaluate model discrimination from 'markers', which may be a *predictive* marker (model predictions) or a *prognostic* marker (a single covariate). This section always defines a marker as a ranking prediction, which is valid for all measures discussed here with the exception of one given at the end.]</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>The TNR for dynamic cases is defined as</span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>TNR_D(\hatrr, N | \alpha, \tau) = P(\hatr_i \leq \alpha | N_i(\tau) = 0)</span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>where $\dvec{\hatr}{n}$ is some deterministic prediction and $N(\tau)$ is a count of the number of events in $[0,\tau)$. Heagerty and Zheng further specify $y$ to be the predicted linear predictor $\hat{\eta}$.  Cumulative/dynamic and incident/dynamic measures are available in software packages 'off-shelf', these are respectively defined by</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>TPR_C(\hatrr, N | \alpha, \tau) = P(\hatr_i &gt; \alpha | N_i(\tau) = 1)</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>TPR_I(\hatrr, N | \alpha, \tau) = P(\hatr_i &gt; \alpha | dN_i(\tau) = 1)</span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>where $dN_i(\tau) = N_i(\tau) - N_i(\tau-)$. Practical estimation of these quantities is not discussed here.</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>The choice between the incident/dynamic (I/D) and cumulative/dynamic (C/D) measures primarily relates to the use-case. The C/D measures are preferred if a specific time-point is of interest <span class="co">[</span><span class="ot">@Heagerty2005</span><span class="co">]</span> and is implemented in several applications for this purpose <span class="co">[</span><span class="ot">@Kamarudin2017</span><span class="co">]</span>. The I/D measures are preferred when the true survival time is known and discrimination is desired at the given event time <span class="co">[</span><span class="ot">@Heagerty2005</span><span class="co">]</span>.</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>Defining a time-specific AUC is now possible with</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>AUC(\hatrr, N | \tau) = \int^1_0 TPR(\hatrr, N | 1 - TNR^{-1}(p|\tau), \tau) \ dp</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>Finally, integrating over all time-points produces a time-dependent AUC and as usual a cut-off is applied for the upper limit,</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>AUC^*(\hatrr,N|\tau^*) = \int^{\tau^*}_0 AUC(\hatrr,N|\tau)\frac{2\hatp_{KM}(\tau)\KMS(\tau)}{1 - \KMS^2(\tau^*)} \ d\tau</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>where $\KMS,\hatp_{KM}$ are survival and mass functions estimated with a Kaplan-Meier model on training data.</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>Since Heagerty and Zheng's paper, other methods for calculating the time-dependent AUC have been devised, including by Chambless and Diao <span class="co">[</span><span class="ot">@Chambless2006</span><span class="co">]</span>, Song and Zhou <span class="co">[</span><span class="ot">@Song2008</span><span class="co">]</span>, and Hung and Chiang <span class="co">[</span><span class="ot">@Hung2010</span><span class="co">]</span>. These either stem from the Heagerty and Zheng paper or ignore the case/control distinction and derive the AUC via different estimation methods of TPR and TNR. Blanche $\etal$ (2012) <span class="co">[</span><span class="ot">@Blanche2012</span><span class="co">]</span> surveyed these and concluded ''regarding the choice of the retained definition for cases and controls, no clear guidance has really emerged in the literature'', but agree with Heagerty and Zeng on the use of C/D for clinical trials and I/D for 'pure' evaluation of the marker.</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>Blanche $\etal$ (2013) <span class="co">[</span><span class="ot">@Blanche2013</span><span class="co">]</span> published a survey of C/D AUC measures with an emphasis on non-parametric estimators with marker-dependent censoring, including their own Conditional IPCW (CIPCW) AUC, which is not discussed further here as it cannot be used for evaluating predictions <span class="co">[</span><span class="ot">@Sonabend2021b</span><span class="co">]</span>.</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>Reviews of AUC measures have produced (sometimes markedly) different results <span class="co">[</span><span class="ot">@Blanche2012; @Li2018; @Kamarudin2017</span><span class="co">]</span> with no clear consensus on how and when these measures should be used.</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>The primary advantage of these measures is to extend discrimination metrics to be time-dependent.</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>However, it is unclear how to interpret a threshold of a linear predictor and moreover if this is even the 'correct' quantity to threshold, especially when survival distribution predictions are the more natural object to evaluate over time.</span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © Raphael Sonabend, Andreas Bender.</p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://www.mlsabook.com">Website</a> | <a href="https://github.com/mlsa-book/MLSA">GitHub</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mlsa-book/MLSA/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/mlsa-book/MLSA/edit/main/book/meas_rank.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/mlsa-book/MLSA/blob/main/book/meas_rank.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>