<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Raphael Sonabend and Andreas Bender">

<title>4&nbsp; Event-history Analysis – Machine Learning in Survival Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./P1C6_survtsk.html" rel="next">
<link href="./P1C4_survival.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-16365895d012c6821ad2015e20b8b579.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-1008a5a8f5e3c2ed0fd245401abc5d00.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./P1C3_machinelearning.html">Survival Analysis and Machine Learning</a></li><li class="breadcrumb-item"><a href="./P1C5_eha.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Event-history Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Machine Learning in Survival Analysis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mlsa-book/MLSA/tree/main/book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Machine-Learning-in-Survival-Analysis.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P0C0_notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Symbols and Notation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P0C1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Survival Analysis and Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C3_machinelearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C4_survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C5_eha.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Event-history Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C6_survtsk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Survival Task</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Evaluation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C8_rank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Discrimination</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C9_calib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Calibration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C10_rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Scoring Rules</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C11_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Survival Time Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C13_classical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Traditional Survival Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C14_forests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Random Forests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C15_svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Support Vector Machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C16_boosting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Boosting Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C17_neural.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Neural Networks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Reduction Techniques</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C19_reductions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Reductions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C20_competing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Competing Risks Pipelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C21_discrete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Discrete Time Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C22_poisson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Connections to Poisson Regression and Processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C23_pseudo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Connections to Regression and Imputation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P5C24_conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">FAQs and Outlook</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P5C25_exercises.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercises</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P5C26_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#a-process-point-of-view" id="toc-a-process-point-of-view" class="nav-link active" data-scroll-target="#a-process-point-of-view"><span class="header-section-number">4.1</span> A process point of view</a></li>
  <li><a href="#sec-competing-risks" id="toc-sec-competing-risks" class="nav-link" data-scroll-target="#sec-competing-risks"><span class="header-section-number">4.2</span> Competing Risks</a>
  <ul class="collapse">
  <li><a href="#notation-and-definitions" id="toc-notation-and-definitions" class="nav-link" data-scroll-target="#notation-and-definitions"><span class="header-section-number">4.2.1</span> Notation and Definitions</a></li>
  <li><a href="#sec-aalen-johanson" id="toc-sec-aalen-johanson" class="nav-link" data-scroll-target="#sec-aalen-johanson"><span class="header-section-number">4.2.2</span> Non-parametric estimators</a></li>
  <li><a href="#application-to-mortality-of-icu-patients" id="toc-application-to-mortality-of-icu-patients" class="nav-link" data-scroll-target="#application-to-mortality-of-icu-patients"><span class="header-section-number">4.2.3</span> Application to mortality of ICU patients</a></li>
  <li><a href="#sec-cens-vs-cr" id="toc-sec-cens-vs-cr" class="nav-link" data-scroll-target="#sec-cens-vs-cr"><span class="header-section-number">4.2.4</span> Independent Censoring vs.&nbsp;Competing Risks</a></li>
  </ul></li>
  <li><a href="#sec-multi-state" id="toc-sec-multi-state" class="nav-link" data-scroll-target="#sec-multi-state"><span class="header-section-number">4.3</span> Multi-state Models</a>
  <ul class="collapse">
  <li><a href="#notation-and-definitions-1" id="toc-notation-and-definitions-1" class="nav-link" data-scroll-target="#notation-and-definitions-1"><span class="header-section-number">4.3.1</span> Notation and Definitions</a></li>
  <li><a href="#transition-probabilities" id="toc-transition-probabilities" class="nav-link" data-scroll-target="#transition-probabilities"><span class="header-section-number">4.3.2</span> Transition probabilities</a></li>
  <li><a href="#transition-probabilities-and-hazards" id="toc-transition-probabilities-and-hazards" class="nav-link" data-scroll-target="#transition-probabilities-and-hazards"><span class="header-section-number">4.3.3</span> Transition probabilities and hazards</a></li>
  <li><a href="#sec-ms-aalen-johanson" id="toc-sec-ms-aalen-johanson" class="nav-link" data-scroll-target="#sec-ms-aalen-johanson"><span class="header-section-number">4.3.4</span> Non-parametric estimation of transition probabilities</a></li>
  <li><a href="#application-to-liver-cirrhosis-patients" id="toc-application-to-liver-cirrhosis-patients" class="nav-link" data-scroll-target="#application-to-liver-cirrhosis-patients"><span class="header-section-number">4.3.5</span> Application to liver cirrhosis patients</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">4.4</span> Conclusion</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mlsa-book/MLSA/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/mlsa-book/MLSA/edit/main/book/P1C5_eha.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/mlsa-book/MLSA/blob/main/book/P1C5_eha.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./P1C3_machinelearning.html">Survival Analysis and Machine Learning</a></li><li class="breadcrumb-item"><a href="./P1C5_eha.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Event-history Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-eha" class="quarto-section-identifier"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Event-history Analysis</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    TODO (150-200 WORDS)
  </div>
</div>


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Major changes expected!
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>This page is a work in progress and major changes will be made over time.</strong></p>
</div>
</div>
<hr>
<p>In this chapter we take a more general view on time-to-event data. So far, we only considered a single potentially censored, outcome of interest. Here we explore more complex settings with multiple, potentially mutually exclusive events and recurrences of events. In this generalization, the observed data is sometimes referred to as <em>event-history data</em> and its analysis as <em>event-history analysis</em>.</p>
<p>One way to think about event history data is in terms of transitions between different states, as illustrated in <a href="#fig-eha" class="quarto-xref">Figure&nbsp;<span>4.1</span></a>. Usually, a subject starts out in an initial state <span class="math inline">\(0\)</span> (for example, ‘healthy’) and from there transitions to different states. States from which further transitions are possible are called <em>transient</em> (displayed as circles), otherwise a state is called <em>terminal</em> or <em>absorbing</em> (displayed as squares).</p>
<p>In the <em>single event</em> setting (<a href="#fig-eha" class="quarto-xref">Figure&nbsp;<span>4.1</span></a>, upper left panel), a subject can only transition to one state (the event of interest). This setting was the focus of <a href="P1C4_survival.html" class="quarto-xref"><span>Chapter 3</span></a>. There, the censoring event was considered independent of the event of interest. In the <em>competing risks</em> setting (<a href="#fig-eha" class="quarto-xref">Figure&nbsp;<span>4.1</span></a>, upper right panel, <a href="#sec-competing-risks" class="quarto-xref"><span>Section 4.2</span></a>), a subject could transition to any of the <span class="math inline">\(q\)</span> mutually exclusive states, thus the subject is initially <em>at risk</em> for a transition to multiple states. Once one of them occurs, the process is considered to have concluded (for the modeling purposes).</p>
<p>In the <em>recurrent events setting</em> (<a href="#fig-eha" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> lower left panel), the same event can be observed multiple times on the same subject (for example recurrent respiratory infections during one year). Two different ways to represent recurrent events are shown: (top) reset the status to <span class="math inline">\(0\)</span> after occurrence of an event or (bottom) consider the <span class="math inline">\(1\)</span>st, <span class="math inline">\(2\)</span>nd, etc. recurrences of the event as separate states. A detail omitted in the graph: Often recurrent event processes also have a competing, absorbing event. In this more complex setting, but also in general, recurrent events are often represented as multi-state process, which we discuss next. Therefore we forgo detailed discussion of this setting in this book and refer to <span class="citation" data-cites="cookStatisticalAnalysisRecurrent2007">Cook and Lawless (<a href="P5C26_references.html#ref-cookStatisticalAnalysisRecurrent2007" role="doc-biblioref">2007</a>)</span> for a detailed account specific to recurrent events analysis.</p>
<p>In the most general case, the <em>multi-state</em> setting (<a href="#fig-eha" class="quarto-xref">Figure&nbsp;<span>4.1</span></a> lower right panel, <a href="#sec-multi-state" class="quarto-xref"><span>Section 4.3</span></a>), there are multiple transient and terminal states with potential back transitions (for example, moving between different stages of an illness with the possibility of (partial) recovery and death as terminal event).</p>
<div id="fig-eha" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Schematic illustration of event history analysis.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-eha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/survival/eha-overview.png" class="img-fluid figure-img" alt="Schematic illustration of event history analysis.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-eha-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Illustration of different types of time-to-event processes. Transient states are displayed as circles, absorbing states are displayed as squares. Top, left: Standard single-event setting with transition from initial state <span class="math inline">\(0\)</span> to state <span class="math inline">\(1\)</span>; Top, right: Competing risks setting with <span class="math inline">\(q\)</span> competing events. The follow-up ends once one of the <span class="math inline">\(\{1,\ldots, q\}\)</span> events is observed or the study ends; Bottom, left: Recurrent events setting with multiple occurrences of the same event. Bottom, right: Multi-state setting where subjects can transition between multiple transient states with possible back-transitions or to absorbing states.
</figcaption>
</figure>
</div>
<p>Note that the concepts discussed in <a href="P1C4_survival.html#sec-types-of-censoring" class="quarto-xref"><span>Section 3.3</span></a> and <a href="P1C4_survival.html#sec-truncation" class="quarto-xref"><span>Section 3.4</span></a> are still relevant here, as, dependent on the specific process, any transition between two states could be subject to different types of censoring and truncation. In particular, remaining in one of the transient states until the end of follow-up constitutes right-censoring with respect to all possible transitions from that state and left-truncation is particularly important as subjects enter the risk sets for a transition at different time points in context of recurrent events and multi-state settings.</p>
<section id="a-process-point-of-view" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="a-process-point-of-view"><span class="header-section-number">4.1</span> A process point of view</h2>
<p>In order to formalize the different settings more conveniently, we introduce the stochastic process <!--  --> <span id="eq-state-process"><span class="math display">\[
E(\tau) \in \{0,\ldots, q\},\ \tau \geq 0,
\tag{4.1}\]</span></span> <!--  --> which indicates the state that is occupied at time <span class="math inline">\(\tau\)</span>.</p>
<p>Using this notation in the single-event setting we get <span class="math inline">\(E(\tau) \in \{0,1\}\)</span> such that the hazard <a href="P1C4_survival.html#eq-continuous-hazard" class="quarto-xref"><span>3.2</span></a> could be written as <!--  --> <span id="eq-continuous-hazard-process"><span class="math display">\[
\begin{aligned}
h(\tau)
  &amp;= \lim_{\mathrm{d}\tau\searrow 0}\frac{P(Y \in [\tau, \tau + \mathrm{d}\tau)|Y \geq \tau)}{\mathrm{d}\tau}\\
  &amp; = \lim_{\mathrm{d}\tau\searrow 0}\frac{P\left(E(\tau + \mathrm{d}\tau)=1|E(\tau-)=0\right)}{\mathrm{d}\tau},
\end{aligned}
\tag{4.2}\]</span></span> <!--  --> where <span class="math inline">\(\tau-\)</span> indicates the time point immediately before <span class="math inline">\(\tau\)</span>.</p>
<p>This notation doesn’t yield many advantages in the single-event setting, but will shorten notation later on, particularly in the multi-state setting. While not further pursued here beyond notational convenience, we refer to <span class="citation" data-cites="aalen2008survivalevent">O. Aalen, Borgan, and Gjessing (<a href="P5C26_references.html#ref-aalen2008survivalevent" role="doc-biblioref">2008</a>)</span> for an excellent treatment of event-history analysis derived from the point of view of stochastic processes.</p>
</section>
<section id="sec-competing-risks" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="sec-competing-risks"><span class="header-section-number">4.2</span> Competing Risks</h2>
<p>In contrast to single-event survival analysis, competing risks are concerned with the time to the first of multiple, mutually exclusive events.</p>
<p><a href="#tbl-surv-data-sir.adm" class="quarto-xref">Table&nbsp;<span>4.1</span></a>. shows an excerpt of the <code>sir.adm</code> data <span class="citation" data-cites="pkgmvna">(<a href="P5C26_references.html#ref-pkgmvna" role="doc-biblioref">Allignol, Beyersmann, and Schumacher 2008</a>)</span> of patients on an intensive care unit (ICU). Time under observation (<code>time</code>) could end in one of three outcomes: <span class="math inline">\(1\)</span> (discharge alive), <span class="math inline">\(2\)</span> (death on ICU) or <span class="math inline">\(0\)</span> (neither discharge nor death at the end of follow-up, which constitutes right-censoring at the end of study). The interest was in how pneumonia status (<code>pneumonia</code>) at admission to the ICU affects mortality.</p>
<div id="tbl-surv-data-sir.adm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-surv-data-sir.adm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Subset of the <code>sir.adm</code> dataset <span class="citation" data-cites="pkgmvna">(<a href="P5C26_references.html#ref-pkgmvna" role="doc-biblioref">Allignol, Beyersmann, and Schumacher 2008</a>)</span>. Each row represent one subject,<code>time</code> is the time under observation, <code>status</code> indicates the outcome observed (<span class="math inline">\(0\)</span>: censored at the end of the study, <span class="math inline">\(1\)</span>: discharged alive from the ICU, <span class="math inline">\(2\)</span>: death in the ICU). <code>pneumonia</code> indicates whether a subject already had pneumonia at ICU admission.
</figcaption>
<div aria-describedby="tbl-surv-data-sir.adm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;"><code>time</code></th>
<th style="text-align: right;"><code>status</code></th>
<th style="text-align: right;"><code>pneumonia</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">no</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">no</td>
</tr>
<tr class="odd">
<td style="text-align: right;">31</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">yes</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">no</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">no</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">no</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Contrast this data to the <code>tumor</code> data example in <a href="P1C4_survival.html#sec-surv-km" class="quarto-xref"><span>Section 3.5.2.1</span></a>. There, patients were followed even after hospital discharge, thus loss to follow-up could be considered reasonably independent of the event of interest (death). In this study, follow-up stopped once patients were discharged. As discharged patients are healthier compared to the ones who remain on ICU, assuming independence between the time until discharge and time until death is unrealistic. Analysis of this data and how the different assumptions (independent censoring vs.&nbsp;competing risks) affects the estimates is discussed in <a href="#sec-aalen-johanson" class="quarto-xref"><span>Section 4.2.2</span></a> and <a href="#sec-cens-vs-cr" class="quarto-xref"><span>Section 4.2.4</span></a>.</p>
<section id="notation-and-definitions" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="notation-and-definitions"><span class="header-section-number">4.2.1</span> Notation and Definitions</h3>
<p>In the competing risks setting, everyone starts out in the initial state <span class="math inline">\(0\)</span> and can progress to one of the absorbing states</p>
<p><span id="eq-absorbing-states"><span class="math display">\[
e \in \{1,\ldots,q\}
\tag{4.3}\]</span></span></p>
<p>These absorbing states are also often refered to as <em>competing events</em>, <em>event types</em>, or <em>causes</em> (as in cause that ended the observation). State <span class="math inline">\(e = 0\)</span> is the initial state and a subject that remains in state <span class="math inline">\(0\)</span> until the end of the follow up is considered censored.</p>
<p>The goal is to characterize the process <span class="math inline">\(E(\tau) \in \{0,\ldots, q\}\)</span> in terms of transition hazards and probabilities. In extension of <a href="#eq-continuous-hazard-process" class="quarto-xref"><span>4.2</span></a>, we define <em>cause-specific</em> hazards <!--  --> <span id="eq-cause-specific-hazard"><span class="math display">\[
h_{e}(\tau) = \lim_{\mathrm{d}\tau\to 0} \frac{P(E(\tau + \mathrm{d}\tau) = e\ |E(\tau-)=0)}{\mathrm{d}\tau}.
\tag{4.4}\]</span></span> <!--  --> Analogous to the single-event case, we can also define the cause-specific cumulative hazard <!--  --> <span id="eq-cause-specific-cumu-hazard"><span class="math display">\[
H_{e}(\tau) = \int_{0}^\tau h_e(u)\ du
\tag{4.5}\]</span></span> <!--  --> As competing events are mutually exclusive at any time <span class="math inline">\(\tau\)</span>, it is possible to define the <em>all-cause hazard</em> which is the hazard of any event occurring as the sum of all cause-specific hazards <!--  --> <span id="eq-all-cause-hazard"><span class="math display">\[
h(\tau) = \sum_{e = 1}^{q}h_{e}(\tau),
\tag{4.6}\]</span></span> <!--  --> as well as the <em>all-cause cumulative hazard</em>, which can be obtained either via the integral over the all-cause hazard (<a href="#eq-all-cause-hazard" class="quarto-xref"><span>4.6</span></a>) or as sum of cause-specific cumulative hazards (<a href="#eq-cause-specific-cumu-hazard" class="quarto-xref"><span>4.5</span></a>):</p>
<p><span id="eq-all-cause-cumu-hazard"><span class="math display">\[
\begin{aligned}
H(\tau)
&amp; = \sum_{e=1}^q H_{e}(\tau) = \sum_{e=1}^{q}\int_{0}^\tau h_{e}(u)\ du\\
&amp; =\int_{0}^\tau \sum_{e=1}^{q} h_{e}(u)\ du = \int_{0}^\tau h(u)\ du
\end{aligned}
\tag{4.7}\]</span></span></p>
<p>The <em>all-cause survival probability</em> gives the probability that <em>none</em> of the events occurred before <span class="math inline">\(\tau\)</span>. This is usually not estimated directly but calculated from the cause specific hazards instead via <a href="#eq-all-cause-cumu-hazard" class="quarto-xref"><span>4.7</span></a> and <a href="#eq-all-cause-surv-prob" class="quarto-xref"><span>4.8</span></a>:</p>
<p><span id="eq-all-cause-surv-prob"><span class="math display">\[
S(\tau) = P(Y &gt; \tau) = \exp(-H(\tau))
\tag{4.8}\]</span></span></p>
<p>Finally, the probability of experiencing an event <span class="math inline">\(e\)</span> before time <span class="math inline">\(\tau\)</span><em>, which is often referred to as Cumulative Incidence Function</em> (CIF), is given by <!--  --> <span id="eq-cif"><span class="math display">\[
\begin{aligned}
F_{e}(\tau) &amp;= P(Y \leq \tau, E(Y) = e)  &amp;\ \\
            &amp; = \int_{0}^\tau f_e(u)\ \mathrm{d}u = \int_{0}^\tau S(u-)h_{e}(u)\ \mathrm{d}u,
\end{aligned}
\tag{4.9}\]</span></span> <!--  --> where</p>
<ul>
<li><span class="math inline">\(S(u-)\)</span> is the probability of surviving (not experiencing any of the competing events) until the time-point shortly before <span class="math inline">\(u\)</span></li>
<li><span class="math inline">\(f_e(u)\mathrm{d}u = S(u-)h_{e}(u)\mathrm{d}u\)</span> is the probability of experiencing event <span class="math inline">\(e\)</span> at time point <span class="math inline">\(u\)</span> (which follows analogously to <a href="P1C4_survival.html#eq-continuous-hazard" class="quarto-xref"><span>3.2</span></a>).</li>
</ul>
<p>Note that here we use the notation <span class="math inline">\(S(u-)\)</span> rather than <span class="math inline">\(S(u)\)</span> to make explicit that we want the probability to survive until the time point immediately before <span class="math inline">\(u\)</span>. This doesn’t make much difference in continuous time where <span class="math inline">\(P(T &gt; t) = P(T\geq t)\)</span>, but may be important in (discrete) approximations (as in <a href="#sec-aalen-johanson" class="quarto-xref"><span>Section 4.2.2</span></a>).</p>
<p><span class="math inline">\(F_e(\tau)\)</span> can be interpreted as the proportion of subjects who experienced event of type <span class="math inline">\(e\)</span> until time <span class="math inline">\(\tau\)</span>. Because the events are mutually exclusive, it holds that <!--  --> <span class="math display">\[
S(\tau) + \sum_{e=1}^q F_e(\tau) =  S(\tau) + F(\tau)= 1
\]</span> <!--  --> where <span class="math inline">\(F(\tau)\)</span> is the probability that an event of any type occurring before <span class="math inline">\(\tau\)</span> and <span class="math inline">\(S(\tau)\)</span> the probability that no event occurs (<a href="#eq-all-cause-surv-prob" class="quarto-xref"><span>4.8</span></a>).</p>
<p>Note that all terms of <a href="#eq-cif" class="quarto-xref"><span>4.9</span></a> can be calculated from the individual hazards (<a href="#eq-cause-specific-hazard" class="quarto-xref"><span>4.4</span></a>). Many estimation procedures for the CIF take this approach, consequently referred to as cause-specific hazards approach.</p>
</section>
<section id="sec-aalen-johanson" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="sec-aalen-johanson"><span class="header-section-number">4.2.2</span> Non-parametric estimators</h3>
<p>Non-parametric estimators for the cause-specific (cumulative) hazard (<a href="#eq-cause-specific-cumu-hazard" class="quarto-xref"><span>4.5</span></a>) in the competing risks setting are derived analogously to the single event case (<a href="P1C4_survival.html#sec-surv-estimation-non-param" class="quarto-xref"><span>Section 3.5.2</span></a>). The non-parametric estimate for the CIF is obtained by plugging in the non-parametric estimates of <span class="math inline">\(S(t)\)</span> and <span class="math inline">\(h(t)\)</span> into (<a href="#eq-cif" class="quarto-xref"><span>4.9</span></a>) as follows.</p>
<p>First, recall from <a href="P1C4_survival.html#sec-data-rc" class="quarto-xref"><span>Section 3.2</span></a> the definitions of the unique ordered event times <span class="math inline">\(t_{(k)}, k=1\ldots,m\)</span>, the risk-set at time <span class="math inline">\(t_{(k)}\)</span>, <span class="math inline">\(\mathcal{R}_{t_{(k)}}\)</span>, the number of events, <span class="math inline">\(d_{t_{(k)}}\)</span>, and number of observations at risk <span class="math inline">\(n_{t_{(k)}}\)</span>. Assume partitioning of the follow-up into <span class="math inline">\(m\)</span> disjoint intervals <span class="math inline">\((t_{(k-1)}, t_{(k)}],k=1,\ldots,m\)</span>, such that <span class="math inline">\(Y\in (t_{(k-1)}, t_{(k)}] \Leftrightarrow \tilde{Y}=t_{(k)}\)</span>, with <span class="math inline">\(\tilde{Y}\)</span> defined as in <a href="P1C4_survival.html#sec-distributions-discrete" class="quarto-xref"><span>Section 3.1.2</span></a>.</p>
<p>An estimate for the <em>cause-specific</em> hazard is derived by updating the numerator in <a href="P1C4_survival.html#eq-disc-haz-non-param" class="quarto-xref"><span>3.13</span></a> to <span class="math inline">\(d_{e,t_{(k)}}\)</span> (the number of events of type <span class="math inline">\(e\)</span> at time <span class="math inline">\(t_{(k)}\)</span>): <!--  --> <span id="eq-cs-discrete-hazard"><span class="math display">\[
h^d_{e}(t_{(k)}) := \frac{d_{e,t_{(k)}}}{n_{t_{(k)}}},\ e \in \{1, \ldots, q\}.
\tag{4.10}\]</span></span> <!--  --></p>
<p>Finally, the Aalen-Johansen (AJ) estimator (<span class="citation" data-cites="aalenEmpiricalTransitionMatrix1978">O. O. Aalen and Johansen (<a href="P5C26_references.html#ref-aalenEmpiricalTransitionMatrix1978" role="doc-biblioref">1978</a>)</span>) for the CIF is obtained by plugging in the Kaplan-Meier estimate (<a href="P1C4_survival.html#eq-km" class="quarto-xref"><span>3.14</span></a>) for the all-cause survival probability (probability that none of the competing events occurred) and the cause-specific hazard (<a href="#eq-cs-discrete-hazard" class="quarto-xref"><span>4.10</span></a>) for cause <span class="math inline">\(e\)</span>into (<a href="#eq-cif" class="quarto-xref"><span>4.9</span></a>): <!--  --> <span id="eq-aalen-johanson"><span class="math display">\[
F_{AJ,e}(\tau) = \sum_{k:t_{(k)}\leq \tau} \hat{S}_{KM}(\tau-)\hat{h}^d_e(\tau)=  \sum_{k:t_{(k)}\leq \tau} \hat{S}_{KM}(t_{(k-1)})\frac{d_{e,t_{(k)}}}{n_{t_{(k)}}}
\tag{4.11}\]</span></span> <!--  --></p>
</section>
<section id="application-to-mortality-of-icu-patients" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="application-to-mortality-of-icu-patients"><span class="header-section-number">4.2.3</span> Application to mortality of ICU patients</h3>
<p>For illustration of the AJ estimator and the interpretation of the CIFs consider the analysis conducted in <span class="citation" data-cites="beyersmann.competing.2012">Beyersmann, Allignol, and Schumacher (<a href="P5C26_references.html#ref-beyersmann.competing.2012" role="doc-biblioref">2012</a>)</span>, based on the data from <a href="#tbl-surv-data-sir.adm" class="quarto-xref">Table&nbsp;<span>4.1</span></a>. Recall that one is interested in estimation of the mortality conditional on pneumonia status at admission, while accounting for discharge from the ICU as competing risk (<span class="math inline">\(E(\tau) \in \{0,1,2\}\)</span>, where <span class="math inline">\(0\)</span> indicates being alive in ICU (the initial state), <span class="math inline">\(1\)</span> indicates discharge from ICU and <span class="math inline">\(2\)</span> indicates death). While the AJ estimator cannot naturally incorporate feature information, it can be applied to subgroups of the data (here based on the pneumonia status <span class="math inline">\(x_{\text{pneu}} \in \{0,1\}\)</span>). Note that this will yield different sets of unique event times in each group, thus the AJ can have jumps at different time-points for the two groups.</p>
<!-- TODO: clean up text below -->
<p><a href="#fig-cif-sir" class="quarto-xref">Figure&nbsp;<span>4.2</span></a> shows the AJ estimates of the CIFs for each event type (discharge/death) stratified by pneumonia status. For example, the proportion of subjects with pneumonia being discharged until <span class="math inline">\(\tau=120\text{ days}\)</span> is approximately 75% (<span class="math inline">\(\hat{F}_{1}(120|x_{\text{pneu}}=1) = \hat{P}(Y \leq 120, E(Y) = 1|x_{\text{pneu}}=1)\approx 0.75\)</span>), while approximately 25% died in the ICU (<span class="math inline">\(\hat{F}_{2}(120|x_{\text{pneu}}=1) = \hat{P}(Y \leq 120, E(Y) = 2|x_{\text{pneu}}=1)\approx 0.25)\)</span>. For patients without pneumonia we have <span class="math inline">\(\hat{F}_{1}(120|x_{\text{pneu}}=0) \approx 0.91\)</span> and <span class="math inline">\(\hat{F}_{2}(120|x_{\text{pneu}}=0) \approx 0.09\)</span>. In this example, <span class="math inline">\(\hat{F}_{1} + \hat{F}_{2} \approx 1\)</span> for both pneumonia groups, as only 14 of 747 patients were censored (neither discharge nor death) at the end of the follow-up and thus the all-cause survival probability <span class="math inline">\(\hat{S}(120) \approx 0\)</span>.</p>
<div id="fig-cif-sir" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Illustration of the Aalen-Johansen estimator for the cumulative incidence function, stratified by pneumonia status at admission to the ICU.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cif-sir-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/survival/cif-sir.png" class="img-fluid figure-img" alt="Illustration of the Aalen-Johansen estimator for the cumulative incidence function, stratified by pneumonia status at admission to the ICU.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cif-sir-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Aalen-Johansen estimator for the <code>sir.adm</code> data <span class="citation" data-cites="pkgmvna">(<a href="P5C26_references.html#ref-pkgmvna" role="doc-biblioref">Allignol, Beyersmann, and Schumacher 2008</a>)</span>, stratified by pneumonia status at admission to the ICU. Left panel: Proportion of subjects discharged alive from the ICU. Right panel: Proportion of subjects who died in the ICU.
</figcaption>
</figure>
</div>
</section>
<section id="sec-cens-vs-cr" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="sec-cens-vs-cr"><span class="header-section-number">4.2.4</span> Independent Censoring vs.&nbsp;Competing Risks</h3>
<p>It is worth spending some time to consider the difference between independent right-censoring and competing risks. Note that for the estimation of the hazard (<a href="#eq-cs-discrete-hazard" class="quarto-xref"><span>4.10</span></a>), occurrences of competing events are implicitly assumed right-censored (as <span class="math inline">\(d_{e,t_{(k)}}\)</span>) only counts events of type <span class="math inline">\(e\)</span> and <span class="math inline">\(n_{t_{(k)}}\)</span> contains the same subjects that would remain if events of type <span class="math inline">\(\tilde{e}\neq e\)</span> were considered censored before <span class="math inline">\(t_{(k)}\)</span>. Nevertheless, competing risks are taken into account in the definition of the CIFs (<a href="#eq-cif" class="quarto-xref"><span>4.9</span></a>) and thus also in the AJ estimator (<a href="#eq-aalen-johanson" class="quarto-xref"><span>4.11</span></a>), as the all-cause survival probability (<a href="#eq-all-cause-surv-prob" class="quarto-xref"><span>4.8</span></a>) depends on all cause-specific hazards.</p>
<p>In contrast, assume that in our analysis of the <code>sir.adm</code> data we would consider time of discharge as independent right-censoring. As we only have one other event (death), the data could be treated as single-event, right-censored data as in <a href="P1C4_survival.html" class="quarto-xref"><span>Chapter 3</span></a> and therefore analyzed using the Nelson-Aalen estimator (<a href="P1C4_survival.html#eq-surv-na" class="quarto-xref"><span>3.16</span></a>). The probability of death before some time-point <span class="math inline">\(\tau\)</span> could thus be obtained via <span class="math inline">\(P(Y\leq \tau) = F(\tau) = 1 - S_{NA}(\tau)\)</span>.</p>
<p><a href="#fig-cens-vs-cr" class="quarto-xref">Figure&nbsp;<span>4.3</span></a> shows the estimates obtained under the two assumptions. Solid lines indicate the probabilities under the competing risks assumption (identical to the right-hand side of <a href="#fig-cif-sir" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>). Dashed lines are obtained under the independent right-censoring assumption. Clearly, the probabilities of dying at time <span class="math inline">\(\tau=120\)</span> are greater when independent censoring is assumed (<span class="math inline">\(\approx\)</span> 75% vs.&nbsp;<span class="math inline">\(\approx\)</span> 25% in the pneumonia group and <span class="math inline">\(\approx\)</span> 62% vs.&nbsp;<span class="math inline">\(\approx\)</span> 13% in the no pneumonia group).</p>
<div id="fig-cens-vs-cr" class="quarto-float quarto-figure quarto-figure-center anchored" alt="">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cens-vs-cr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/survival/cens-vs-cr.png" class="img-fluid figure-img" alt="">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cens-vs-cr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.3: Estimation of the probability of dying in the ICU conditional on pneumonia status at admission. Dashed lines give the probabilities under assumption of right-censoring. Solid lines give the probabilities when taking into account discharge as competing risk.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="sec-multi-state" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="sec-multi-state"><span class="header-section-number">4.3</span> Multi-state Models</h2>
<p>The multi-state process can be considered the most general type of time-to-event process, as other types (single-event, competing risks, recurrent events) can be viewed as special cases. Multi-state modeling allows realistic depiction of complex processes where subjects can start in different states and transition back and forth between them.</p>
<p>For illustration consider the <code>prothr</code> dataset <span class="citation" data-cites="pkgmstate">(<a href="P5C26_references.html#ref-pkgmstate" role="doc-biblioref">de Wreede, Fiocco, and Putter 2011</a>)</span> of liver cirrhosis patients from a randomized clinical trial with possible transitions depicted in <a href="#fig-multi-state-prothr-states" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>. Patients may have normal (state <span class="math inline">\(0\)</span>) or abnormal (state <span class="math inline">\(1\)</span>) levels of prothrombin (a protein important for blood clotting, produced by the liver) at the beginning of the trial. Some patients where treated with prednisone (which suppresses immune response and reduces inflammation) and others received a placebo. Death (state <span class="math inline">\(2\)</span>) constitutes an absorbing state.</p>
<div id="fig-multi-state-prothr-states" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Transition probabilities for the prothrombin data example.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multi-state-prothr-states-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/survival/multi-state-prothr-states.png" class="img-fluid figure-img" alt="Transition probabilities for the prothrombin data example.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multi-state-prothr-states-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.4: Transition graph for the liver cirrhosis patients.
</figcaption>
</figure>
</div>
<p>The goal of the trial was to investigate if treatment (prednisone) slows down or reverses disease progression (transitions <span class="math inline">\(0 \rightarrow 1\)</span> and <span class="math inline">\(1 \rightarrow 0\)</span>) and reduces mortality (transitions <span class="math inline">\(0 \rightarrow 2\)</span> and <span class="math inline">\(1 \rightarrow 2\)</span>).</p>
<p><a href="#tbl-ms-data-prothr" class="quarto-xref">Table&nbsp;<span>4.2</span></a> shows a subset of the data set and contains for each subject (<code>id</code>)one row for each transition for which the subject was at risk for. In this example, this includes transitions that were possible, but didn’t happen (counterfactual transitions). The columns <code>from</code> and <code>to</code> indicate the initial state and the possible end state. <code>tstart</code> indicates the time at which the subject entered the risk set for said transitions and <code>tstop</code> the time point at which the subjects exited the <code>from</code> state (or were censored for any transition). The variable <code>status</code> indicates whether the transition was actually made (<code>status = 1</code>) or not (<code>status = 0</code>). This is necessary, as all possible transitions are listed, so we need an indicator for which transition actually occurred. If <code>status=0</code> for all possible transitions, the subject is censored for further transitions. Finally, <code>treatment</code> indicates whether a patient was assigned the treatment or placebo group.</p>
<p>Concretely, subject <code>id=1</code> already had abnormal prothrombin levels at the beginning of the trial, thus started in state <span class="math inline">\(1\)</span> with possible transitions <span class="math inline">\(1\rightarrow 0\)</span> and <span class="math inline">\(1 \rightarrow 2\)</span>. In this case, the patient died, thus transition <span class="math inline">\(1\rightarrow 2\)</span> was realized after 151 days, while the transition <span class="math inline">\(1 \rightarrow 0\)</span> is a ‘counterfactual’ transition that could have happened in the time-span between <code>tstart=0</code> and <code>tend=151</code>, but didn’t. Patient <code>id=8</code> also started in state <span class="math inline">\(1\)</span>, but made a back transition to normal prothrombin levels after 211 days at which time they entered the risk set for transitions <span class="math inline">\(0\rightarrow 1\)</span> and <span class="math inline">\(0\rightarrow 2\)</span>. Neither of the transitions occurred, as <code>status=0</code> for both transitions, which means the subject remained in status <span class="math inline">\(0\)</span> until the end of their follow-up at 2770 days (that is was right-censored at 2770 days). Finally, subject <code>id=46</code> started in state 0 (normal prothrombin levels), transitioned to state 1 (abnormal levels) after 415 days and then died (transition <span class="math inline">\(1\rightarrow 2\)</span>) two days later. This also illustrates the importance of left-truncation (<a href="P1C4_survival.html#sec-truncation" class="quarto-xref"><span>Section 3.4</span></a>) in multi-state processes. For example, subjects <code>id=1</code> and <code>id=8</code> are at risk for the transitions <span class="math inline">\(1 \rightarrow 0\)</span> and <span class="math inline">\(1 \rightarrow 2\)</span> from the beginning of the trial (<code>tstart = 0</code>). Subject <code>id=46</code> on the other hand starts in state 0 and only enters state <span class="math inline">\(1\)</span> (and thus the risk set for the transitions <span class="math inline">\(1\rightarrow 0\)</span> and <span class="math inline">\(1\rightarrow 2\)</span>) after 415 days (<code>tstart = 415</code>). Other subjects in the data may never enter the risk set for these transitions by remaining in state 0 until the end of follow up or by directly transitioning to state <span class="math inline">\(2\)</span>. The fact that subjects enter the risk sets for different transitions at different time points technically constitutes left-truncation and thus should be taken into account accordingly (<a href="#sec-ms-aalen-johanson" class="quarto-xref"><span>Section 4.3.4</span></a>).</p>
<div id="tbl-ms-data-prothr" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ms-data-prothr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: Subset of the <code>prothr</code> dataset <span class="citation" data-cites="pkgmstate">(<a href="P5C26_references.html#ref-pkgmstate" role="doc-biblioref">de Wreede, Fiocco, and Putter 2011</a>)</span>.
</figcaption>
<div aria-describedby="tbl-ms-data-prothr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: right;">from</th>
<th style="text-align: right;">to</th>
<th style="text-align: right;">trans</th>
<th style="text-align: right;">tstart</th>
<th style="text-align: right;">tstop</th>
<th style="text-align: right;">status</th>
<th style="text-align: left;">treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">151</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Placebo</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">151</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Placebo</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">211</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Prednisone</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">211</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Prednisone</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">211</td>
<td style="text-align: right;">2770</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Prednisone</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">211</td>
<td style="text-align: right;">2770</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Prednisone</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">415</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Prednisone</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">415</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Prednisone</td>
</tr>
<tr class="odd">
<td style="text-align: right;">46</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">415</td>
<td style="text-align: right;">417</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">Prednisone</td>
</tr>
<tr class="even">
<td style="text-align: right;">46</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">415</td>
<td style="text-align: right;">417</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Prednisone</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="notation-and-definitions-1" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="notation-and-definitions-1"><span class="header-section-number">4.3.1</span> Notation and Definitions</h3>
<p>In the competing risks setting, we characterized the data generating process by cause-specific transitions hazards <span class="math inline">\(h_e(\tau)\)</span> (<a href="#eq-cause-specific-hazard" class="quarto-xref"><span>4.4</span></a>). Implicitly these are transitions from starting state <span class="math inline">\(0\)</span> to end state <span class="math inline">\(e\)</span>, however, since everyone starts in state <span class="math inline">\(0\)</span> this is ignored notationally. In the multi-state setting on the other hand, subjects can be in different states at different time points. Transitions between different states are therefore characterized by transition-specific hazards, denoted by <span class="math inline">\(h_{\ell\rightarrow e}(\tau)\)</span> or short <span class="math inline">\(h_{\ell e}(\tau)\)</span>, where <span class="math inline">\(\ell\)</span> is the starting state and <span class="math inline">\(e\)</span> the end state.</p>
<p>Let <span class="math inline">\(E(\tau)\in \{0,\ldots,q\}\)</span> be the state of the process at time <span class="math inline">\(\tau\)</span> as before (<a href="#eq-state-process" class="quarto-xref"><span>4.1</span></a>). Then, the transition-specific hazard can be defined as <!--  --> <span id="eq-ms-transition-hazards"><span class="math display">\[
h_{\ell e}(\tau) = \lim_{\mathrm{d}\tau\to 0} \frac{P(E(\tau + \mathrm{d}\tau)=e|E(\tau-) = \ell)}{\mathrm{d}\tau}
\tag{4.12}\]</span></span></p>
<p>Transition hazards <a href="#eq-ms-transition-hazards" class="quarto-xref"><span>4.12</span></a> indicate the instantaneous risk to enter state <span class="math inline">\(e\)</span> at time <span class="math inline">\(\tau\)</span> given occupation of state <span class="math inline">\(\ell\)</span> at <span class="math inline">\(\tau-\)</span>, which is the instant before <span class="math inline">\(\tau\)</span>.</p>
<p>Analogous to the competing risks setting, we can define the transition specific cumulative hazards</p>
<p><span id="eq-ms-cumu-hazard"><span class="math display">\[
H_{\ell e}(\tau) = \int_{0}^{\tau}h_{\ell e}(u)du
\tag{4.13}\]</span></span></p>
<p>The probability to transition from state <span class="math inline">\(\ell\)</span> to <span class="math inline">\(e\)</span> between two time-points depends on all transitions possible from <span class="math inline">\(\ell\)</span> and potentially the transitions that have taken place in the past. Thus, other quantities of interest in the multi-state setting are the transition probabilities <span class="math inline">\(P_{\ell e}(\zeta, \tau):= P(E(\tau) = e|E(\zeta) = \ell)\)</span>, that is the probability to transition from state <span class="math inline">\(\ell\)</span> to state <span class="math inline">\(e\)</span> between time points <span class="math inline">\(\zeta &lt; \tau\)</span>. Implicitly, this notation assumes that the process is Markovian: the transition probability depends only on the state at <span class="math inline">\(\zeta\)</span> and not any additional past states. Extensions do exist that relax this assumption, for example by including information about the past, but are not relevant for now.</p>
<p>Transition probabilities of a multi-state process are often summarized in a matrix <!--  --> <span id="eq-ms-trans-prob-mat"><span class="math display">\[
\mathbf{P}(\zeta, \tau):=
\begin{pmatrix}
  P_{00}(\zeta, \tau) &amp; \cdots &amp; P_{0q}(\zeta, \tau)\\
  \vdots &amp; \ddots &amp; \vdots\\
  P_{q0}(\zeta, \tau) &amp; \cdots &amp; P_{qq}(\zeta, \tau)\\
\end{pmatrix},
\tag{4.14}\]</span></span> <!--  --> where rows indicate starting states and columns indicate end states. Some of the elements of <span class="math inline">\(\mathbf{P}\)</span> might be zero or one depending on the specific process, presence of absorbing states and possible pathways between states. As subjects can only be in one of the <span class="math inline">\(q+1\)</span> states at <span class="math inline">\(\tau\)</span>, rows sum to <span class="math inline">\(1\)</span>: <!--  --> <span id="eq-ms-trans-prob-row-sums"><span class="math display">\[
\sum_{e =0}^q P_{\ell e} = 1,\forall \ell \in \{0, \ldots,q\}.
\tag{4.15}\]</span></span> <!--  --></p>
</section>
<section id="transition-probabilities" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="transition-probabilities"><span class="header-section-number">4.3.2</span> Transition probabilities</h3>
<p>In this section we briefly motivate how transition probabilities between two non-consecutive time points can be expressed as the product (integral) of transition probabilities between intermediate, subsequent time points.</p>
<p>For illustration, consider what is often referred to as an illness-death model depicted in <a href="#fig-illness-death" class="quarto-xref">Figure&nbsp;<span>4.5</span></a> (similar to <a href="#fig-multi-state-prothr-states" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>, but without back-transition), where subjects can transition from healthy state <span class="math inline">\(0\)</span> to absorbing death state <span class="math inline">\(2\)</span> either directly or via intermediate state <span class="math inline">\(1\)</span>.</p>
<div id="fig-illness-death" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Graph of the illness-death model.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-illness-death-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/survival/illness-death-model.png" class="img-fluid figure-img" alt="Graph of the illness-death model.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-illness-death-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.5: An <em>illness-death model</em> where subjects can transition from healthy state (<span class="math inline">\(0\)</span>) to death (<span class="math inline">\(2\)</span>) directly or via intermediate illness state (<span class="math inline">\(1\)</span>)
</figcaption>
</figure>
</div>
<p>In this example, back-transitions are not possible, therefore the lower triangle of the matrix is filled with zeros and <span class="math inline">\(P_{22}(\zeta, \tau) = 1, \forall\ \zeta &lt; \tau\)</span> by virtue of being an absorbing state. The matrix of transition probabilities is thus given as <!--  --> <span id="eq-ms-trans-prob-mat-illness-death"><span class="math display">\[
\mathbf{P}(\zeta, \tau) =
  \begin{pmatrix}
  P_{00}(\zeta, \tau) &amp; P_{01}(\zeta, \tau) &amp; P_{02}(\zeta, \tau)\\
  0 &amp; P_{11}(\zeta, \tau) &amp; P_{12}(\zeta, \tau)\\
  0 &amp; 0 &amp; 1\\
  \end{pmatrix}
\tag{4.16}\]</span></span> <!--  --> First, assume that data is collected in discrete time, that is <span class="math inline">\(\zeta, \tau \in \{0, 1, 2,\ldots\}, \zeta &lt; \tau\)</span> and transitions only occur at these discrete time points and not in between. Say we are interested in transition probability <span class="math inline">\(P_{02}(4, 6)\)</span>, that is the probability to transition from state <span class="math inline">\(0\)</span> to state <span class="math inline">\(2\)</span> between time points <span class="math inline">\(\zeta=4\)</span> and <span class="math inline">\(\tau=6\)</span>, given we are in state <span class="math inline">\(0\)</span> at time <span class="math inline">\(\zeta = 4\)</span>. This is possible in the three ways depicted in <a href="#fig-prothr-ex-graph" class="quarto-xref">Figure&nbsp;<span>4.6</span></a>.</p>
<div id="fig-prothr-ex-graph" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Transition probabilities for the prothrombin data example.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-prothr-ex-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/survival/example-transitions-prothr-graph.png" class="img-fluid figure-img" alt="Transition probabilities for the prothrombin data example.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-prothr-ex-graph-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.6: Possible paths to transition from state <span class="math inline">\(0\)</span> to state <span class="math inline">\(2\)</span> between time points 4 and 6
</figcaption>
</figure>
</div>
<!-- FIXME: make sure colors are actually the same in graph and text -->
<p>Thus, <span class="math inline">\(P_{02}(4,6) = \textcolor{blue}{p_{00}(5)p_{02}(6)} + \textcolor{green}{p_{01}(5)p_{12}(6)} + \textcolor{orange}{p_{02}(5)}\)</span>, where <span class="math inline">\(p_{\ell e}(\tau)=P(E(\tau)=e|E(\tau -1) = \ell)\)</span> are the probabilities for transitions <span class="math inline">\(\ell \rightarrow e\)</span> between two subsequent discrete time points. Thus, in discrete time, the matrix of transition probabilities can be represented as a finite matrix product</p>
<p><span id="eq-ms-trans-prob-ill-death-discrete"><span class="math display">\[
\mathbf{P}(\zeta, \tau) = \prod_{j =\zeta+1}^{\tau}
\begin{pmatrix}
  p_{00}(j) &amp; p_{01}(j) &amp; p_{02}(j)\\
  0 &amp; p_{11}(j) &amp; p_{12}(j)\\
  0 &amp; 0 &amp; 1\\
  \end{pmatrix}.
\tag{4.17}\]</span></span></p>
<!-- FIXME: FORMATTING -->
<p>For the concrete example we thus have</p>
<p><span class="math display">\[
\begin{aligned}
\mathbf{P}(4, 6) &amp;=
\begin{pmatrix}
P_{00}(4, 6) &amp; P_{01}(4, 6) &amp; P_{02}(4, 6)\\
        0 &amp; P_{11}(4, 6) &amp; P_{12}(4,6)\\
        0 &amp;         0 &amp;         1
\end{pmatrix} = \prod_{j=5}^6
\begin{pmatrix}
p_{00}(j) &amp; p_{01}(j) &amp; p_{02}(j)\\
        0 &amp; p_{11}(j) &amp; p_{12}(j)\\
        0 &amp;         0 &amp;         1
\end{pmatrix}\\
            &amp; =
\begin{pmatrix}
p_{00}(5) &amp; p_{01}(5) &amp; p_{02}(5)\\
        0 &amp; p_{11}(5) &amp; p_{12}(5)\\
        0 &amp;         0 &amp;         1
\end{pmatrix}
\begin{pmatrix}
p_{00}(6) &amp; p_{01}(6) &amp; p_{02}(6)\\
        0 &amp; p_{11}(6) &amp; p_{12}(6)\\
        0 &amp;         0 &amp;         1
\end{pmatrix}\\
            &amp;=
\begin{pmatrix}
p_{00}(5) p_{00}(6) &amp; p_{00}(5)p_{01}(6) + p_{01}(5)p_{11}(6) &amp; p_{00}(5)p_{02}(6) + p_{01}(5)p_{12}(6) + p_{02}(5)\\
        0           &amp; p_{11}(5) p_{11}(6)&amp; p_{11}(5)p_{12}(6) + p_{12}(5)\\
        0           &amp;                  0 &amp;         1
\end{pmatrix},
\end{aligned}
\]</span></p>
<p>where the quantity of interest, <span class="math inline">\(P_{02}(4, 6)\)</span> is given in the top right corner, but other transition probabilities are also readily available. For example, the probability to transition from state <span class="math inline">\(1\)</span> to <span class="math inline">\(2\)</span> between time points <span class="math inline">\(\zeta=4\)</span> and <span class="math inline">\(\tau=6\)</span> is given as <span class="math inline">\(P_{12}(4, 6) = p_{11}(5)p_{12}(6) + p_{12}(5)\)</span>.</p>
<p>Returning to the continuous time setting where transitions can occur at any time point, ideas from the discrete time setting still hold. Imagine dividing the interval <span class="math inline">\((\zeta, \tau]\)</span> into <span class="math inline">\(J\)</span> intervals such that <span class="math inline">\(\zeta = t_{0} &lt; t_{1} &lt; \cdots &lt; t_{j} &lt; \cdots t_{J} = \tau\)</span>, assuming that no events occur between time points <span class="math inline">\(t_{j} \in \mathbb{R}_+, j=1,\ldots, J\)</span>. Then <a href="#eq-ms-trans-prob-ill-death-discrete" class="quarto-xref"><span>4.17</span></a> still holds when replacing <span class="math inline">\(p_{\ell e}(j)\)</span> with <span class="math inline">\(p_{\ell e}(t_j)\)</span>.</p>
</section>
<section id="transition-probabilities-and-hazards" class="level3" data-number="4.3.3">
<h3 data-number="4.3.3" class="anchored" data-anchor-id="transition-probabilities-and-hazards"><span class="header-section-number">4.3.3</span> Transition probabilities and hazards</h3>
<p>Increasing the number of intervals to infinity or equivalently, reducing the interval size to infinitesimally small intervals we can define the transition probability matrix as a product integral over the instantaneous transition probabilities <span class="math inline">\(p_{\ell e}(u)\)</span>, expressed in terms of transition-specific (cumulative) hazards.</p>
<p>To do so, we use, somewhat informally, the following relationships</p>
<ul>
<li>From equations <a href="#eq-ms-transition-hazards" class="quarto-xref"><span>4.12</span></a> and <a href="#eq-ms-cumu-hazard" class="quarto-xref"><span>4.13</span></a> we can equate the instantaneous transition probabilities to increments of the cumulative hazard (that is the increase in the cumulative hazard within a (fixed, infinitesimally) small interval <span class="math inline">\(\mathrm{d}u\)</span>): <span class="math inline">\(dH_{\ell e}(u) = P\big(E(u+du)=e|E(u-) = \ell\big) =: p_{\ell e}(u)\)</span>,</li>
<li>because of relationship <a href="#eq-ms-trans-prob-row-sums" class="quarto-xref"><span>4.15</span></a>, diagonal elements (transitions into the same state) are set to <span class="math inline">\(dH_{\ell \ell}(u) := -\sum_{e \neq \ell} dH_{\ell e}(u)\)</span> such that <span class="math inline">\(1 + dH_{\ell\ell}(u) = 1-\sum_{e \neq \ell} dH_{\ell e}(u) = 1 - \sum_{e\neq \ell}p_{\ell e}(u) = p_{\ell\ell}(u)\)</span>.</li>
</ul>
<p>Consequently, the transition probability matrix can be written as <!--  --> <span id="eq-ms-prodint-cumu-hazards"><span class="math display">\[
\begin{aligned}
\mathbf{P}(\zeta, \tau)
                        &amp;= \mathscr{P}_{u \in (\zeta, \tau]}
  \begin{pmatrix}
    p_{00}(u) = 1 + dH_{00}(u) &amp; \cdots &amp; p_{0q}(u) = dH_{0q}(u)\\
    \vdots                  &amp; \ddots &amp; \vdots\\
    p_{q0}(u) =  dH_{q0}(u)     &amp; \cdots &amp; p_{qq}(u) = 1 + dH_{qq}(u)\\
  \end{pmatrix}\nonumber\\
  &amp; \ \\
  &amp; =  \mathscr{P}_{u \in (\zeta, \tau]}(\mathbf{I} + d\mathbf{H}(u)),\nonumber\\
\end{aligned}
\tag{4.18}\]</span></span> <!--  --> where <span class="math inline">\(\mathscr{P}\)</span> is the product integral operator, <span class="math inline">\(\mathbf{I}\)</span> is a <span class="math inline">\((q+1) \times (q+1)\)</span> identity matrix and <span class="math inline">\(d\mathbf{H}(u)\)</span> is the matrix of increments of the cumulative hazard within infinitesimally small intervals. Thus, similar to the competing risks setting, relationship <a href="#eq-ms-prodint-cumu-hazards" class="quarto-xref"><span>4.18</span></a> implies that knowledge of the transition specific (cumulative) hazards is sufficient to fully specify the multi-state process.</p>
<p>As analytical solutions of <a href="#eq-ms-prodint-cumu-hazards" class="quarto-xref"><span>4.18</span></a> only exist for specific models, in practice, the transition probabilities are often once again approximated numerically via a finite matrix product on a discrete time grid <span class="math inline">\(\zeta = t_0 &lt; t_1 &lt; \cdots &lt; t_{J-1} &lt; t_{J} = \tau\)</span> <!--  --> <span id="eq-ms-prodint-approx"><span class="math display">\[
\mathbf{P}(\zeta, \tau) \approx \prod_{j=1}^{J}(\mathbf{I} + \triangle\mathbf{H}_{\ell e}(t_{j})),
\tag{4.19}\]</span></span> <!--  --> where <span class="math inline">\(\triangle H_{\ell e}(t_{j}) = H_{\ell e}(t_{j}) - H_{\ell e}(t_{j-1})\)</span> is the increment of the cumulative hazards between to consecutive time points.</p>
</section>
<section id="sec-ms-aalen-johanson" class="level3" data-number="4.3.4">
<h3 data-number="4.3.4" class="anchored" data-anchor-id="sec-ms-aalen-johanson"><span class="header-section-number">4.3.4</span> Non-parametric estimation of transition probabilities</h3>
<p>From <a href="#eq-ms-prodint-approx" class="quarto-xref"><span>4.19</span></a>, it follows that transition probabilities can be estimated by first computing the transition-specific cumulative hazards, <span class="math inline">\(H_{\ell e}(\tau)\)</span>. Similarly to the competing risks setting (<a href="#sec-aalen-johanson" class="quarto-xref"><span>Section 4.2.2</span></a>), we can first define the transition specific hazards <!--  --> <span class="math display">\[
h^{d}_{\ell e}(t_{(k)}):= \frac{d_{\ell e,t_{(k)}}}{n_{\ell; t_{(k)}}},
\]</span> <!--  --> where</p>
<ul>
<li><span class="math inline">\(d_{\ell e,t_{(k)}}\)</span> is the number of subjects that made the transition <span class="math inline">\(\ell \rightarrow e\)</span> at time <span class="math inline">\(t_{(k)}\)</span> and</li>
<li><span class="math inline">\(n_{\ell; t_{(k)}}\)</span> is the number of subjects in state <span class="math inline">\(\ell\)</span> immediately before <span class="math inline">\(t_{(k)}\)</span>.</li>
</ul>
<p>The cumulative transition-specific hazards follow as <!--  --> <span class="math display">\[
H_{NA,\ell e}(\tau) = \sum_{k:t_{(k)}\leq \tau} h^d_{\ell e}(t_{(k)}) = \sum_{k:t_{(k)}\leq \tau}\frac{d_{\ell e,t_{(k)}}}{n_{\ell; t_{(k)}}},
\]</span> <!--  --></p>
<p>and transition probabilities are obtained via <a href="#eq-ms-prodint-approx" class="quarto-xref"><span>4.19</span></a> as <!--  --> <span id="eq-ms-aj-trans-prob"><span class="math display">\[
\mathbf{P}(\zeta, \tau) = \prod_{j=1}^{J}\big(\mathbf{I} + \triangle\mathbf{H}_{NA,\ell e}(t_{(j)})\big).
\tag{4.20}\]</span></span> <!--  --></p>
</section>
<section id="application-to-liver-cirrhosis-patients" class="level3" data-number="4.3.5">
<h3 data-number="4.3.5" class="anchored" data-anchor-id="application-to-liver-cirrhosis-patients"><span class="header-section-number">4.3.5</span> Application to liver cirrhosis patients</h3>
<p>For illustration, consider again the <code>prothr</code> data set (<a href="#tbl-ms-data-prothr" class="quarto-xref">Table&nbsp;<span>4.2</span></a>), with possible transitions summarized in <a href="#fig-multi-state-prothr-states" class="quarto-xref">Figure&nbsp;<span>4.4</span></a>. In contrast to the illness-death model in <a href="#fig-illness-death" class="quarto-xref">Figure&nbsp;<span>4.5</span></a>, back transitions are possible and some subjects already start in the “abnormal” state at the beginning of the study.</p>
<p><a href="#fig-multi-state-prothr" class="quarto-xref">Figure&nbsp;<span>4.7</span></a> shows the transition probabilities for the four possible transitions over time for subjects who received treatment and placebo, respectively. In this example back-transitions are possible, therefore, in contrast to the cumulative incidence functions in the competing risks setting, transition probabilities (to transient states) are not monotonously increasing over time. While the probabilities to transition from normal or abnormal state to death (<span class="math inline">\(0 \rightarrow 2\)</span>, <span class="math inline">\(1 \rightarrow 2\)</span>) increase over time for both groups, probabilities for transitions between the transient states (normal to abnormal and vice versa) increase in the beginning but eventually decreases over time. Overall, prednisone doesn’t appear to have a strong protective effect. Although there appears to be a reduction in <span class="math inline">\(0 \rightarrow 2\)</span> transitions and an increase in <span class="math inline">\(1\rightarrow 0\)</span> transitions between time points <span class="math inline">\(1000\)</span> and <span class="math inline">\(3000\)</span>, this effect doesn’t seem to persist until the end of the follow up.</p>
<div id="fig-multi-state-prothr" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Transition probabilities for the prothrombin data example.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multi-state-prothr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/survival/multi-state-prothr.png" class="img-fluid figure-img" alt="Transition probabilities for the prothrombin data example.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multi-state-prothr-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.7: Estimated transition probabilities for the different transitions of the prothrombin data example .
</figcaption>
</figure>
</div>
</section>
</section>
<section id="conclusion" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">4.4</span> Conclusion</h2>
<div class="callout callout-style-default callout-warning no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Key takeaways
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Defining the state diagram of the data generating process can be helpful to understand the dynamics in the data and to select an appropriate framework (and model) for the analysis.</li>
<li>Non-parmetric estimators like the Aalen-Johanson estimator can be used as first step in the analysis of competing risks and multi-state settings.</li>
<li>The empirical transition matrix provides a general procedure to obtain estimates of transition probabilties based on any learner that can estimate transition-specific hazards.</li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Further reading
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><span class="citation" data-cites="aalen2008survivalevent">O. Aalen, Borgan, and Gjessing (<a href="P5C26_references.html#ref-aalen2008survivalevent" role="doc-biblioref">2008</a>)</span> introduces different approaches for event-history analysis motivated from the point of view of the counting process.</li>
<li><span class="citation" data-cites="beyersmann.competing.2012">Beyersmann, Allignol, and Schumacher (<a href="P5C26_references.html#ref-beyersmann.competing.2012" role="doc-biblioref">2012</a>)</span> provide an accessible overview of important concepts for competing risks and multi-state modelling, particularly non-parametric estimation.</li>
</ul>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-aalenEmpiricalTransitionMatrix1978" class="csl-entry" role="listitem">
Aalen, Odd O., and Søren Johansen. 1978. <span>“An <span>Empirical Transition Matrix</span> for <span>Non-Homogeneous Markov Chains Based</span> on <span>Censored Observations</span>.”</span> <em>Scandinavian Journal of Statistics</em> 5 (3): 141–50. <a href="https://www.jstor.org/stable/4615704">https://www.jstor.org/stable/4615704</a>.
</div>
<div id="ref-aalen2008survivalevent" class="csl-entry" role="listitem">
Aalen, Odd, Ornulf Borgan, and Hakon Gjessing. 2008. <em><span>Survival and Event History Analysis: A Process Point of View</span></em>. 2008th ed. New York, NY: Springer.
</div>
<div id="ref-pkgmvna" class="csl-entry" role="listitem">
Allignol, Arthur, Jan Beyersmann, and Martin Schumacher. 2008. <span>“Mvna an r Package for the Nelson-Aalen Estimator in Multistate Models.”</span> <em>R News</em> 8 (2): 48–50.
</div>
<div id="ref-beyersmann.competing.2012" class="csl-entry" role="listitem">
Beyersmann, Jan, Arthur Allignol, and Martin Schumacher. 2012. <em>Competing Risks and Multistate Models with <span>R</span></em>. Use <span>R</span>! New York: Springer.
</div>
<div id="ref-cookStatisticalAnalysisRecurrent2007" class="csl-entry" role="listitem">
Cook, Richard J., and Jerald F. Lawless. 2007. <em>The <span>Statistical Analysis</span> of <span>Recurrent Events</span></em>. Statistics for <span>Biology</span> and <span>Health</span>. New York, NY: Springer. <a href="https://doi.org/10.1007/978-0-387-69810-6">https://doi.org/10.1007/978-0-387-69810-6</a>.
</div>
<div id="ref-pkgmstate" class="csl-entry" role="listitem">
de Wreede, Liesbeth C., Marta Fiocco, and Hein Putter. 2011. <span>“<span class="nocase">mstate</span>: An <span>R</span> Package for the Analysis of Competing Risks and Multi-State Models.”</span> <em>Journal of Statistical Software</em> 38 (7): 1–30. <a href="https://doi.org/10.18637/jss.v038.i07">https://doi.org/10.18637/jss.v038.i07</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./P1C4_survival.html" class="pagination-link" aria-label="Survival Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./P1C6_survtsk.html" class="pagination-link" aria-label="Survival Task">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Survival Task</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © Raphael Sonabend, Andreas Bender.</p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://www.mlsabook.com">Website</a> | <a href="https://github.com/mlsa-book/MLSA">GitHub</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mlsa-book/MLSA/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/mlsa-book/MLSA/edit/main/book/P1C5_eha.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/mlsa-book/MLSA/blob/main/book/P1C5_eha.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>