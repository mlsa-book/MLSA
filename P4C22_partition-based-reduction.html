<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Raphael Sonabend and Andreas Bender">

<title>18&nbsp; Partition based reductions – Machine Learning in Survival Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./P4C24_eha.html" rel="next">
<link href="./P4C21_pseudo.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-14d2473a982606de670f0038afa36c2b.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-1008a5a8f5e3c2ed0fd245401abc5d00.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./P4C19_reductions.html">Reduction Techniques</a></li><li class="breadcrumb-item"><a href="./P4C22_partition-based-reduction.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Partition based reductions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Machine Learning in Survival Analysis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/mlsa-book/MLSA/tree/main/book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Machine-Learning-in-Survival-Analysis.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P0C0_notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Symbols and Notation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P0C1_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Survival Analysis and Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C3_machinelearning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Machine Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C4_survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C5_eha.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Event-history Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P1C6_survtsk.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Survival Task</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Evaluation</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C8_rank.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Discrimination</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C9_calib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Calibration</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C10_rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Scoring Rules</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P2C11_time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Survival Time Measures</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Models</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C13_classical.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Traditional Survival Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C14_forests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Random Forests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C15_svm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Support Vector Machines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C16_boosting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Boosting Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P3C17_neural.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Neural Networks</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Reduction Techniques</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C19_reductions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Reduction Techniques for Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C20_ipcw.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">IPC weighted classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C21_pseudo.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Pseudo-value regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C22_partition-based-reduction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Partition based reductions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P4C24_eha.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Reductions for Event-History Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P5C24_conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">FAQs and Outlook</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./P5C26_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-data-transformation" id="toc-sec-data-transformation" class="nav-link active" data-scroll-target="#sec-data-transformation"><span class="header-section-number">18.1</span> Data Transformation</a></li>
  <li><a href="#sec-discrete-time-reduction" id="toc-sec-discrete-time-reduction" class="nav-link" data-scroll-target="#sec-discrete-time-reduction"><span class="header-section-number">18.2</span> Discrete Time Survival Analysis</a>
  <ul class="collapse">
  <li><a href="#example-logistic-regression" id="toc-example-logistic-regression" class="nav-link" data-scroll-target="#example-logistic-regression"><span class="header-section-number">18.2.1</span> Example: Logistic Regression</a></li>
  </ul></li>
  <li><a href="#sec-survival-stacking" id="toc-sec-survival-stacking" class="nav-link" data-scroll-target="#sec-survival-stacking"><span class="header-section-number">18.3</span> Survival Stacking</a></li>
  <li><a href="#sec-piecewise-constant-hazards" id="toc-sec-piecewise-constant-hazards" class="nav-link" data-scroll-target="#sec-piecewise-constant-hazards"><span class="header-section-number">18.4</span> Piecewise Constant Hazards</a>
  <ul class="collapse">
  <li><a href="#example-poisson-regression" id="toc-example-poisson-regression" class="nav-link" data-scroll-target="#example-poisson-regression"><span class="header-section-number">18.4.1</span> Example: Poisson Regression</a></li>
  </ul></li>
  <li><a href="#sec-choice-of-interval-boundaries" id="toc-sec-choice-of-interval-boundaries" class="nav-link" data-scroll-target="#sec-choice-of-interval-boundaries"><span class="header-section-number">18.5</span> Choice of Interval Boundaries</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/mlsa-book/MLSA/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/mlsa-book/MLSA/edit/main/book/P4C22_partition-based-reduction.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/mlsa-book/MLSA/blob/main/book/P4C22_partition-based-reduction.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./P4C19_reductions.html">Reduction Techniques</a></li><li class="breadcrumb-item"><a href="./P4C22_partition-based-reduction.html"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Partition based reductions</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-partition-based-reductions" class="quarto-section-identifier"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Partition based reductions</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="block-title">Abstract</div>
    TODO (150-200 WORDS)
  </div>
</div>


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Major changes expected!
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>This page is a work in progress and major changes will be made over time.</strong></p>
</div>
</div>
<p>In contrast to the previously introduced reductions that focus on the estimation of a specific quantity of interest at one or few time points, partition-based reduction aim to estimate the entire distribution of the event times (similar to Cox models and other survival learners). The general idea is to partition the time axis into <span class="math inline">\(J\)</span> intervals <span class="math inline">\((a_0,a_1],\ldots,(a_{J-1},a_J]\)</span> and estimate a discrete or continuous hazard rate for each interval.</p>
<p>For illustration, consider the partitioning of the follow up in Figure <a href="#fig-fu-partitioning" class="quarto-xref">Figure&nbsp;<span>18.1</span></a>. Note that the intervals do not necessarily have to be equidistant. The <span class="math inline">\(j\)</span>th interval is given by <span class="math inline">\(I_j:=(a_{j-1},a_j]\)</span>. Let further <span class="math inline">\(J_i\)</span> the index of the interval in which observed time <span class="math inline">\(t_i\)</span> of subject <span class="math inline">\(i\)</span> falls, that is <span class="math inline">\(t_i \in I_{J_i} = (a_{J_i-1},a_{J_i}]\)</span>.</p>
<div id="fig-fu-partitioning" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Partitioning the follow-up time into discrete intervals.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fu-partitioning-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/reductions/fu-partitioning.png" class="img-fluid figure-img" style="width:80.0%" alt="Partitioning the follow-up time into discrete intervals.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fu-partitioning-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.1: Partitioning of the follow-up time into <span class="math inline">\(J\)</span> discrete intervals <span class="math inline">\((a_0,a_1], \ldots, (a_{J-1},a_J]\)</span>. This partitioning forms the basis for both reduction techniques discussed in this chapter.
</figcaption>
</figure>
</div>
<p>Formally, define the partitioning of the follow-up via the set of interval boundary points <span class="math inline">\(a_j\)</span> for <span class="math inline">\(j=0,\ldots,J\)</span> as</p>
<p><span id="eq-cut-points"><span class="math display">\[\mathcal{A} = \{a_0, \ldots, a_J\}, \quad a_0 &lt; a_1 &lt; \ldots &lt; a_J \tag{18.1}\]</span></span></p>
<p>This partitioning is used to create a transformed data set. Using this transformed data, standard regression or classification methods can be used in order to estimate (discrete) hazards in each interval. <a href="#sec-data-transformation" class="quarto-xref"><span>Section 18.1</span></a> introduces the required data transformation formally. <a href="#sec-discrete-time-reduction" class="quarto-xref"><span>Section 18.2</span></a>, <a href="#sec-survival-stacking" class="quarto-xref"><span>Section 18.3</span></a> and <a href="#sec-piecewise-constant-hazards" class="quarto-xref"><span>Section 18.4</span></a> introduce specific reductions based on this data transformation, provide theoretical justification why models applied to such transformed data are valid approaches for estimation in time-to-event analysis and provide illustrative examples for such models. <a href="#sec-choice-of-interval-boundaries" class="quarto-xref"><span>Section 18.5</span></a> discusses computational aspects and modeling choices (related to the choice of interval boundaries <span class="math inline">\(a_j\)</span>).</p>
<section id="sec-data-transformation" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="sec-data-transformation"><span class="header-section-number">18.1</span> Data Transformation</h2>
<p>In order to apply the reduction techniques introduced in the upcoming sections, standard time-to-event data needs to be transformed into a specific format. The transformation is based on the partitioning of the follow-up as illustrated in Figure <a href="#fig-fu-partitioning" class="quarto-xref">Figure&nbsp;<span>18.1</span></a> and boundaries as defined in <a href="#eq-cut-points" class="quarto-xref"><span>18.1</span></a>. The new data set contains <span class="math inline">\(J_i\)</span> rows for each subject <span class="math inline">\(i\)</span>, that is one row for each interval in which subject <span class="math inline">\(i\)</span> was at risk of experiencing an event. <!-- Thus the overall number of rows in the transoformed data is given by  --> <!-- --> <!-- $$\tilde{n} = \sum_{i=1}^n J_i = \sum_{i=1}^n \sum_{j=1}^J \II(t_i > a_{j-1}).$$ --> <!--  --></p>
<p>For each subject <span class="math inline">\(i\)</span>, we record the the subject’s interval-specific event indicator <!--  --> <span id="eq-interval-indicator"><span class="math display">\[\delta_{ij} = \begin{cases}
1, &amp; t_i \in (a_{j-1}, a_j] \text{ and } \delta_i = 1 \\
0, &amp; \text{ else }
\end{cases},\quad j=1,\ldots,J_i, \tag{18.2}\]</span></span> <!--  --></p>
<p>the time at risk in interval <span class="math inline">\(j\)</span> <!--  --> <span id="eq-time-at-risk"><span class="math display">\[t_{ij} = \begin{cases}
a_j - a_{j-1}, &amp; \text{ if } t_i &gt; a_j \\
t_i - a_{j-1}, &amp; \text{ if } t_i \in (a_{J_i-1}, a_{J_i}]\\
\end{cases},\quad j=1,\ldots,J_i, \tag{18.3}\]</span></span> <!--  --></p>
<p>as well as some representation of the time in interval <span class="math inline">\(j\)</span>, for example the interval midpoint or endpoint <!--  --> <span id="eq-interval-endpoint"><span class="math display">\[t_j = a_j \tag{18.4}\]</span></span> <!--  --></p>
<p>and the subject’s (potentially time-dependent)features <!--  --> <span id="eq-interval-features"><span class="math display">\[\mathbf{x}_{ij} \tag{18.5}\]</span></span> <!--  --> with <span class="math inline">\(\mathbf{x}_{ij} = \mathbf{x}_{i}\)</span> for all <span class="math inline">\(j\)</span>, if the features are constant over time.</p>
<p>Thus, given the partition <span class="math inline">\(\mathcal{A}\)</span>, the standard time-to-event data <span class="math inline">\(\mathcal{D}= \{(t_i, \delta_i, \mathbf{x}_i)\}_{i=1,\ldots,n}\)</span> is transformed to data <!--  --> <span id="eq-transformed-data"><span class="math display">\[\mathcal{D}_{\mathcal{A}} = \{(i, j, \delta_{ij}, t_{ij}, t_j, \mathbf{x}_{ij})\}_{i=1,\ldots,n;\  j=1,\ldots,J_i}, \tag{18.6}\]</span></span> <!--  --> where <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> indices are usually only used for “book-keeping” purposes but are not used in modeling later on.</p>
<p>The data transformation procedure described above is illustrated in Figure <a href="#fig-data-trafo" class="quarto-xref">Figure&nbsp;<span>18.2</span></a> for hypothetical data. The left hand side of Figure <a href="#fig-data-trafo" class="quarto-xref">Figure&nbsp;<span>18.2</span></a> shows data in standard time-to-event format with one row per subject <span class="math inline">\(i=1,\ldots,3\)</span> and <span class="math inline">\(\mathcal{D} = \{(1.3, 0, 31), (0.5, 1, 57), (2.7, 1, 42)\}\)</span>. For the transformation, we choose (arbitrary) interval boundaries <span class="math inline">\(\mathcal{A} = \{1, 1.5, 3\}\)</span>, which gives intervals <span class="math inline">\((0,1], (1,1.5], (1.5,3]\)</span>. The right-hand side of Figure <a href="#fig-data-trafo" class="quarto-xref">Figure&nbsp;<span>18.2</span></a> shows the transformed data <span class="math inline">\(\mathcal{D}_{\mathcal{A}}\)</span>, where the first three columns keep track of subject and interval information and the other columns are the interval-specific event indicator, time at risk in the respective interval,representation of time and (time-dependent) features as defined in Equations <a href="#eq-interval-indicator" class="quarto-xref"><span>18.2</span></a>, <a href="#eq-time-at-risk" class="quarto-xref"><span>18.3</span></a>, <a href="#eq-interval-endpoint" class="quarto-xref"><span>18.4</span></a> and <a href="#eq-interval-features" class="quarto-xref"><span>18.5</span></a>, respectively.</p>
<div id="fig-data-trafo" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Partitioning the follow-up time into discrete intervals.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-data-trafo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/reductions/data-trafo-pem.png" class="img-fluid figure-img" style="width:80.0%" alt="Partitioning the follow-up time into discrete intervals.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-data-trafo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.2: Illustration of the data transfomration needed for partition based reductions. Left: Data in standard time-to-event format. Right: Transformed data using interval boundaries <span class="math inline">\(\mathcal{A} = \{1, 1.5, 3\}\)</span>.
</figcaption>
</figure>
</div>
<p>Note that <span class="math inline">\(\delta_{ij}=0\)</span> for all intervals except the last of subject <span class="math inline">\(i\)</span>, where <span class="math inline">\(\delta_{iJ_i} = \delta_i\)</span>, so either 0 or 1. Thus the total number of events is the same in both the original and transformed data. In general, both data sets contain the same time-to-event information as the original data since, given the interval boundaries <span class="math inline">\(\mathcal{A}\)</span>, the variables <span class="math inline">\(\delta_{ij}\)</span> and <span class="math inline">\(t_{ij}\)</span> are deterministic functions of the original data.</p>
</section>
<section id="sec-discrete-time-reduction" class="level2" data-number="18.2">
<h2 data-number="18.2" class="anchored" data-anchor-id="sec-discrete-time-reduction"><span class="header-section-number">18.2</span> Discrete Time Survival Analysis</h2>
<p>Consider the partitioning of the follow-up <a href="#eq-cut-points" class="quarto-xref"><span>18.1</span></a> and assume we are only interested in whether the event occured within an interval rather than the exact event time. Using the notation from <a href="P1C4_survival.html#sec-distributions-discrete" class="quarto-xref"><span>Section 3.1.2</span></a>, the likelihood contribution of the <span class="math inline">\(i\)</span>th observation is given by <span class="math inline">\(P(Y_i \in (a_{J_i-1}, a_{J_i}]) = P(\tilde{Y}_i = J_i)\)</span> for subjects who experienced an event (<span class="math inline">\(\delta_i = 1\)</span>) and <span class="math inline">\(P(Y_i &gt; a_{J_i}) = P(\tilde{Y}_i &gt; J_i)\)</span> for subjects who were censored (<span class="math inline">\(\delta_i = 0\)</span>).</p>
<p>Thus, using definitions <a href="P1C4_survival.html#eq-discrete-surv-prob" class="quarto-xref"><span>3.7</span></a> and <a href="P1C4_survival.html#eq-discrete-prob" class="quarto-xref"><span>3.8</span></a>, the likelihood contribution of subject <span class="math inline">\(i\)</span> is given by <!--  --> <span id="eq-discrete-likelihood-1"><span class="math display">\[\begin{aligned}L_i
&amp; = P(Y_i \in (a_{J_i-1}, a_{J_i}])^{\delta_i} P(Y_i &gt; a_{J_i})^{1-\delta_i}\\
&amp; = \left[S^d(J_i-1)h^d(J_i)\right]^{\delta_i} \left[S^d(J_i)\right]^{1-\delta_i}\\
&amp; = \left[\left(\prod_{j=1}^{J_i-1} (1-h^d(j))\right)h^d(J_i)\right]^{\delta_i} \left[\prod_{j=1}^{J_i} (1-h^d(j))\right]^{1-\delta_i},
\end{aligned} \tag{18.7}\]</span></span> <!--  --></p>
<p>Now recall from Equation <a href="#eq-interval-indicator" class="quarto-xref"><span>18.2</span></a> the definition of the interval-specific event indicators <span class="math inline">\(\delta_{ij}\)</span>, which always take value 0, except for the last interval, where <span class="math inline">\(\delta_{iJ_i} = \delta_i\)</span>. Thus, the first part of <a href="#eq-discrete-likelihood-1" class="quarto-xref"><span>18.7</span></a> can be written as <span class="math inline">\(\prod_{j=1}^{J_i}(1-h^d(j))^{1-\delta_{ij}}h^d(j)^{\delta_{ij}}\)</span> and the second part as <span class="math inline">\(\prod_{j=1}^{J_i}(1-h^d(j))^{1-\delta_{ij}}\)</span>. It follows, that the likelihood <a href="#eq-discrete-likelihood-1" class="quarto-xref"><span>18.7</span></a> can be written as <!--  --> <span id="eq-discrete-likelihood-2"><span class="math display">\[\begin{aligned}
L_i
&amp; = \left[\prod_{j=1}^{J_i} (1-h^d(j))^{1-\delta_{ij}}h^d(j)^{\delta_{ij}}\right]^{\delta_i} \left[\prod_{j=1}^{J_i} (1-h^d(j))^{1-\delta_{ij}}\right]^{1-\delta_i}\\
&amp; = \prod_{j=1}^{J_i} (1-h^d(j))^{1-\delta_{ij}}h^d(j)^{\delta_{ij}},
\end{aligned} \tag{18.8}\]</span></span> <!--  --> where the last equality follows from <span class="math inline">\(\delta_{ij}=0\ \forall j=1,\ldots,J_i\)</span>, if <span class="math inline">\(\delta_i = 0\)</span> and thus <span class="math inline">\(\prod{1-h^d(j)}^{1-\delta_{ij}}h^d(j)^{\delta_{ij}} = \prod{1-h^d(j)}^{1-\delta_{ij}}\)</span>.</p>
<p>The importance of this result may not be immediately apparent, but recall that if <span class="math inline">\(Z \sim Bernoulli(\pi)\)</span>, where <span class="math inline">\(\pi = P(Z = 1)\)</span>, then likelihood contribution of <span class="math inline">\(Z\)</span> is given by <span class="math inline">\(P(Z = z) = \pi^z (1-\pi)^{1-z}\)</span>. We therefore recognize that the likelihood contribution <a href="#eq-discrete-likelihood-2" class="quarto-xref"><span>18.8</span></a> can also be obtained by assuming that the interval-specific event indicators <span class="math inline">\(\delta_{ij}\)</span> are realizations of random variables <span class="math inline">\(\Delta_{ij} \stackrel{iid}{\sim} Bernoulli(\pi_j = h^d(j))\)</span>. Thus <!--  --> <span id="eq-discrete-hazard-probability"><span class="math display">\[\begin{aligned}
\pi_j &amp; = P(\Delta_{ij} = 1|t_j)\\ &amp; = P(Y_i \in (a_{j-1}, a_j] | Y_i &gt; a_{j-1}) = h^d(j)
\end{aligned} \tag{18.9}\]</span></span> <!--  --> Note that in <a href="#eq-discrete-hazard-probability" class="quarto-xref"><span>18.9</span></a>, <span class="math inline">\(\Delta_{ij} =1\)</span> is equivalent to <span class="math inline">\(Y_i \in (a_{j-1}, a_j]\)</span>, while the conditioning on <span class="math inline">\(Y_i &gt; a_{j-1}\)</span> is implicit in the definition of <span class="math inline">\(\delta_{ij}\)</span> in <a href="#eq-interval-indicator" class="quarto-xref"><span>18.2</span></a>.</p>
<p>This implies that we can estimate the discrete time hazards <span class="math inline">\(h^d(j)\)</span> for each interval <span class="math inline">\(j\)</span> by fitting any binary classifcation model to the transformed data set <!--  --> <span id="eq-discrete-data"><span class="math display">\[\mathcal{D}_{\mathcal{A}} = \{(\delta_{ij}, t_{j})\}_{i=1,\ldots,n;\quad j=1,\ldots,J_i}, \tag{18.10}\]</span></span> <!--  --> where <span class="math inline">\(\delta_{ij}\)</span> are the targets and <span class="math inline">\(t_{j}\)</span>, some representation of time in interval <span class="math inline">\(j\)</span> (for example <span class="math inline">\(t_j = j\)</span> or <span class="math inline">\(t_j = a_{j}\)</span>), enters the estimation as a feature and is needed in order to estimate different hazards/probabilities in different intervals.</p>
<p>In the presence of features <span class="math inline">\(\mathbf{x}_{i}\)</span> we assume <span class="math inline">\(\Delta_{ij}| \mathbf{x}_{i}, t_j \stackrel{iid}{\sim} Ber(\pi_{ij})\)</span>, where <span class="math inline">\(\pi_{ij} = P(\Delta_{ij} = 1| \mathbf{x}_{i}, t_j) = h^d(j|\mathbf{x}_{i})\)</span> is the discrete hazard rate for interval <span class="math inline">\(j\)</span> given features <span class="math inline">\(\mathbf{x}_{i}\)</span> and is estimated by applying binary classifiers to <!--  --> <span class="math display">\[\mathcal{D}_{\mathcal{A}} = \{(\delta_{ij}, \mathbf{x}_{i}, t_{j})\}_{i=1,\ldots,n;\quad j=1,\ldots,J_i}.\]</span> <!--  --></p>
<section id="example-logistic-regression" class="level3" data-number="18.2.1">
<h3 data-number="18.2.1" class="anchored" data-anchor-id="example-logistic-regression"><span class="header-section-number">18.2.1</span> Example: Logistic Regression</h3>
<p>To illustrate the discrete time reduction approach, once again consider the tumor data set introduced in Table <a href="P1C4_survival.html#tbl-surv-data-tumor" class="quarto-xref">Table&nbsp;<span>3.1</span></a>. The follow-up time is partitioned into <span class="math inline">\(J = 100\)</span> equidistant intervals and the data is transformed according to the procedure described in <a href="#sec-data-transformation" class="quarto-xref"><span>Section 18.1</span></a>. Define <span class="math inline">\(x_{i1} = \mathbb{I}(\text{complications}_i = \text{"yes"})\)</span>. We then fit a logistic regression model <!--  --> <span id="eq-discrete-time-glm-po"><span class="math display">\[\text{logit}(\pi_{ij}) = \beta_{0j} + \beta_1x_{i1}
\tag{18.11}\]</span></span> <!--  --> to the transformed data set, where <span class="math inline">\(j\)</span> denotes the interval index, <span class="math inline">\(\beta_{0j}\)</span> are the interval-specific intercepts (technically we include the interval index <span class="math inline">\(j\)</span> as a reference coded categorical feature in the model) and <span class="math inline">\(\beta_1\)</span> is the common effect of complications on the discrete hazard rate (accross all intervals).</p>
<p>The estimated survival probabilities are obtained by calculating <span class="math inline">\(\hat{S}^d(j|x_{1}) = \prod_{k=1}^j (1-\hat{h}^d(k|x_{1}))\)</span> for each interval <span class="math inline">\(j\)</span> and complication group, where <span class="math inline">\(\hat{h}^d(k|x_{1})\)</span> are the predicted discrete hazards from the logistic regression model.</p>
<p>Figure <a href="#fig-discrete-time-glm" class="quarto-xref">Figure&nbsp;<span>18.3</span></a> shows the estimated survival probabilities from the discrete time model (dashed lines) together with the Kaplan-Meier estimates (solid lines) for comparison. The model specified in Equation <a href="#eq-discrete-time-glm-po" class="quarto-xref"><span>18.11</span></a> is a proportional odds model, where the baseline hazard is the same for both complication groups, thus the shape of the hazard and therefore the survival probability curve is the same for both complication groups, shifted by the common effect of complications. This does not describe the data too well as the hazards are different in the two groups (as already established in XXX)</p>
<div id="fig-discrete-time-glm" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Single plot showing survival curves for patients with and without complications. Kaplan-Meier estimates are shown as solid lines (black for no complications, gray for complications) and discrete time model estimates are shown as dashed blue lines (darker blue for no complications, lighter blue for complications).">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-discrete-time-glm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/reductions/discrete-time-complications-glm.png" class="img-fluid figure-img" alt="Single plot showing survival curves for patients with and without complications. Kaplan-Meier estimates are shown as solid lines (black for no complications, gray for complications) and discrete time model estimates are shown as dashed blue lines (darker blue for no complications, lighter blue for complications).">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-discrete-time-glm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.3: Comparison of survival probability estimates using the discrete time model (logistic regression) and the Kaplan-Meier estimator, for patients with and without complications.
</figcaption>
</figure>
</div>
<p>In order to estimate separate discrete baseline hazards for each group, we can introduce an interaction term between the interval and complications variables. <!--  --> <span id="eq-discrete-time-glm-interaction"><span class="math display">\[\text{logit}(\pi_{ij}) = \beta_{0j} + \beta_{1j}x_{i1}
\tag{18.12}\]</span></span> <!--  --> where <span class="math inline">\(\beta_{0j}\)</span> are the interval-specific intercepts for the reference group (no complications), <span class="math inline">\(\beta_{1j}\)</span> are the deviations from the reference group for the complications group (technically this is fit as an interaction model using reference coded categorical features for interval and complications). This specification allows the shape of the hazard and therefore the survival probability curve to be different for the two groups.</p>
<p>Figure <a href="#fig-discrete-time-glm-interaction" class="quarto-xref">Figure&nbsp;<span>18.4</span></a> shows the estimated survival probabilities from the interaction model (dashed lines) together with the Kaplan-Meier estimates (solid lines) for comparison. The interaction model provides a much better fit to the data compared to the proportional odds model, as it allows for separate baseline hazards for each complications group. The difference to the Kaplan-Meier estimates is barely detectable.</p>
<div id="fig-discrete-time-glm-interaction" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Single plot showing survival curves for patients with and without complications. Kaplan-Meier estimates are shown as solid lines and discrete time model estimates with interaction are shown as dashed lines, both colored by complications status.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-discrete-time-glm-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/reductions/discrete-time-complications-glm-interaction.png" class="img-fluid figure-img" alt="Single plot showing survival curves for patients with and without complications. Kaplan-Meier estimates are shown as solid lines and discrete time model estimates with interaction are shown as dashed lines, both colored by complications status.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-discrete-time-glm-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.4: Comparison of survival probability estimates using the discrete time model with interaction (logistic regression) and the Kaplan-Meier estimator, for patients with and without complications.
</figcaption>
</figure>
</div>
<p>While this is a simple example with only one feature, it shows that the discrete time reduction approach can be used to estimate the distribution of event times well when the number of intervals is large enough, despite the fact that we ignore the information about the exact event time. Importantly, the estimated survival probabilities are discrete, representing survival probabilities at the interval endpoints. However, a simple solution to generate continuous survival function predictions is to linearly interpolate between the interval endpoints.</p>
<p>The example also raises the question about the choice of the number of intervals <span class="math inline">\(J\)</span> and the placement of interval boundaries <span class="math inline">\(\mathcal{A}\)</span>. These questions will be discussed in more detail in <a href="#sec-choice-of-interval-boundaries" class="quarto-xref"><span>Section 18.5</span></a>, which is relevant for both, the discrete time reduction approach and the piecewise constant hazards approach discussed in <a href="#sec-piecewise-constant-hazards" class="quarto-xref"><span>Section 18.4</span></a>.</p>
</section>
</section>
<section id="sec-survival-stacking" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="sec-survival-stacking"><span class="header-section-number">18.3</span> Survival Stacking</h2>
<p>Survival stacking (<span class="citation" data-cites="craigreviewsurvival">Craig, Zhong, and Tibshirani (<a href="P5C26_references.html#ref-craigreviewsurvival" role="doc-biblioref">2025</a>)</span>) casts survival tasks to classification tasks similarly to the discrete time method described in Section <a href="#sec-discrete-time-reduction" class="quarto-xref"><span>Section 18.2</span></a>. However, there is a small but important difference in the creation of event indicators <span class="math inline">\(\delta_{ij}\)</span>. Rather than constructing intervals based on partitioning of the follow-up along boundary points <span class="math inline">\(\mathcal{A}\)</span>, survival stacking uses the unique, observed, ordered event times <span class="math inline">\(t_{(1)}, &lt; \ldots &lt; t_{(m)}\)</span> (<a href="P1C4_survival.html#eq-unique-ordered-event-times" class="quarto-xref"><span>3.9</span></a>) and defines <!--  --> <span id="eq-interval-indicator-stacking"><span class="math display">\[\delta_{ij} = \begin{cases}
1, &amp; t_i = t_{(j)} \text{ and } \delta_i = 1 \\
0, &amp; \text{ else }
\end{cases},\quad j \in \{1,\ldots,m: i \in R_{t_{(j)}}\} \tag{18.13}\]</span></span> <!--  --> where <span class="math inline">\(R_{t_{(j)}}\)</span> is the risk set (<a href="P1C4_survival.html#eq-risk-set" class="quarto-xref"><span>3.10</span></a>) at time <span class="math inline">\(t_{(j)}\)</span>.</p>
<p>Definition <a href="#eq-interval-indicator-stacking" class="quarto-xref"><span>18.13</span></a> implies that the event indicators <span class="math inline">\(\delta_{ij}\)</span> are only defined for timepoints <span class="math inline">\(t_{(j)}\)</span> at which subject <span class="math inline">\(i\)</span> is still at risk for the event. Therefore, this method can be easily applied to left-truncated data by using the more general definition of the risk set (<a href="P1C4_survival.html#eq-risk-lt" class="quarto-xref"><span>3.18</span></a>).</p>
<p>For illustration, consider once again, the example from Figure <a href="#fig-data-trafo" class="quarto-xref">Figure&nbsp;<span>18.2</span></a>. The adapted data-transformation for survival stacking is shown in Figure <a href="#fig-data-trafo-stacking" class="quarto-xref">Figure&nbsp;<span>18.5</span></a> (droping columns that are not meaningful here). At the first event time <span class="math inline">\(t_{(1)} = 0.5\)</span>, all subjects are sitll at risk for the event. At time <span class="math inline">\(t_{(2)} = 2.7\)</span>, however, only subject <span class="math inline">\(3\)</span> is still at risk for the event.</p>
<!-- https://drive.google.com/file/d/1kOnoJpER1hrM19x5IQ1PqAAAh0G-wvqZ/view?usp=sharing -->
<div id="fig-data-trafo-stacking" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Partitioning the follow-up time into discrete intervals.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-data-trafo-stacking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/reductions/data-trafo-pooled-log-reg.png" class="img-fluid figure-img" style="width:80.0%" alt="Partitioning the follow-up time into discrete intervals.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-data-trafo-stacking-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.5: Illustration of the data transfomration needed for survival stacking. Left: Data in standard time-to-event format. Right: Transformed data using unique, observed event times <span class="math inline">\(t_{(1)}, &lt; \ldots &lt; t_{(m)}\)</span>.
</figcaption>
</figure>
</div>
<p>Note that in contrast to <a href="#fig-data-trafo" class="quarto-xref">Figure&nbsp;<span>18.2</span></a>, here subject <span class="math inline">\(1\)</span> has only one row and subject <span class="math inline">\(3\)</span> has two rather than three rows. This could suggest that the data transformation for survival stacking creates smaller data sets, however, we need to create a data set for each observed event time <span class="math inline">\(t_{(j)}, j=1,\ldots,m\)</span>, whereas for the discret time approach in <a href="#sec-discrete-time-reduction" class="quarto-xref"><span>Section 18.2</span></a> one can freely choose the number and placement of interval boundaries <span class="math inline">\(\mathcal{A}\)</span>, such that <span class="math inline">\(|\mathcal{A}| &lt; m\)</span> in most cases.</p>
<p>Data transformation <a href="#eq-interval-indicator-stacking" class="quarto-xref"><span>18.13</span></a> yields data <!--  --> <span id="eq-survival-stacking-data"><span class="math display">\[\mathcal{D}_{\mathcal{A}} = \{(\delta_{ij}, t_{j}, \mathbf{x}_{ij})\}_{i=1,\ldots,n;\ j=1,\ldots,m:\ i \in R_{t_{(j)}}}, \tag{18.14}\]</span></span> <!--  --> where the <span class="math inline">\(\delta_{ij}\)</span> can be used as targets for binary classification and as before, any algorithm that returns class probabilities can be used for estimation.</p>
</section>
<section id="sec-piecewise-constant-hazards" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="sec-piecewise-constant-hazards"><span class="header-section-number">18.4</span> Piecewise Constant Hazards</h2>
<p>The general idea of the piecewise constant hazards approach is conceptually simple:</p>
<ol type="1">
<li>Partition the follow-up into many intervals</li>
<li>Estimate a constant hazard rate for each interval</li>
</ol>
<p>Intuitively, any underlying continuous hazard function of the data generating process can be approximated arbitrarily well given enough intervals (and events). This model class is known as the piecewise exponential model (PEM) because assuming event times to be exponentially distributed, implies constant hazards within each interval.</p>
<p>Consider the partitioning of the follow-up as defined in <a href="#eq-cut-points" class="quarto-xref"><span>18.1</span></a> and assume that within each interval <span class="math inline">\(I_j = (a_{j-1}, a_j]\)</span>, the hazard function is constant, that is <!--  --> <span id="eq-constant-hazard"><span class="math display">\[h(\tau) = h_j,\ \forall\ \tau \in I_j \tag{18.15}\]</span></span> <!--  --></p>
<p>First we derive the likelihood contribution of subject <span class="math inline">\(i\)</span> under assumption <a href="#eq-constant-hazard" class="quarto-xref"><span>18.15</span></a>, starting with the general likelihood for right-censored data (<a href="P1C4_survival.html#eq-right-censoring-likelihood" class="quarto-xref"><span>3.12</span></a>): <!--  --> <span id="eq-pem-likelihood-general"><span class="math display">\[\begin{aligned}
\mathcal{L}_{i}
&amp; = h(t_i)^{\delta_{i}}S(t_i)\\
&amp; = h(t_i)^{\delta_{i}}\exp\left(-\int_{0}^{t_i} h(u) \ \mathrm{d}u\right)\\
&amp; = h_{J_i}^{\delta_{i}}\exp\left(-\left[\sum_{j=1}^{J_i-1} (a_j - a_{j-1})h_j + (t_i - a_{J_i-1})h_{J_i}\right]\right)\\
&amp; = h_{J_i}^{\delta_{i}}\exp\left(-\sum_{j=1}^{J_i} h_j t_{ij}\right) = h_{J_i}^{\delta_{i}}\prod_{i=1}^{J_i}\exp\left(- h_j t_{ij}\right)\\
&amp; = \prod_{j=1}^{J_i} h_j^{\delta_{ij}} \exp(-h_j t_{ij}),
\end{aligned} \tag{18.16}\]</span></span> <!--  --> where the first equality follows from <a href="P1C4_survival.html#eq-surv-haz" class="quarto-xref"><span>3.4</span></a>, the third and fourth equalities follow from assumption <a href="#eq-constant-hazard" class="quarto-xref"><span>18.15</span></a> and definition <a href="#eq-time-at-risk" class="quarto-xref"><span>18.3</span></a>, and the last equality follows from <a href="#eq-interval-indicator" class="quarto-xref"><span>18.2</span></a> such that <span class="math inline">\(h_{J_i}^{\delta_i} = \prod_{j=1}^{J_i} h_j^{\delta_{ij}}\)</span> (when <span class="math inline">\(\delta_i = 0\)</span>, all <span class="math inline">\(\delta_{ij} = 0\)</span>, when <span class="math inline">\(\delta_{i} = 1\)</span>, only <span class="math inline">\(\delta_{iJ_i} = 1\)</span>).</p>
<p>Now assume that the interval-specific event indicators <span class="math inline">\(\delta_{ij}\)</span> are realizations of random variables <span class="math inline">\(\Delta_{ij} \stackrel{iid}\sim \text{Poisson}(\mu_{ij} : = h_j t_{ij})\)</span> and recall that <span class="math inline">\(Z\sim \text{Poisson}(\mu)\)</span> implies <span class="math inline">\(P(Z = z) = \frac{\mu^z \exp(-\mu)}{z!}\)</span>. Thus, the likelihood contribution of subject <span class="math inline">\(i\)</span> can be written as <!--  --> <span id="eq-pem-poisson-likelihood"><span class="math display">\[\begin{aligned}
\mathcal{L}_{\text{Poisson},i}
&amp; = \prod_{j=1}^{J_i} P(\Delta_{ij} = \delta_{ij}) = \prod_{j=1}^{J_i} \frac{(h_j t_{ij})^{\delta_{ij}} \exp(-h_j t_{ij})}{\delta_{ij}!}\\
&amp; = \prod_{j=1}^{J_i} h_j^{\delta_{ij}} t_{ij}^{\delta_{ij}}\exp(-h_j t_{ij}),
\end{aligned} \tag{18.17}\]</span></span> <!--  --> where the last equality follows from <span class="math inline">\(\delta_{ij} \in \{0,1\}\)</span> and <span class="math inline">\(0!=1!=1\)</span>.</p>
<p>Note that <span class="math inline">\(\mathcal{L}_{i,\text{Poisson}} \propto \mathcal{L}_i\)</span> from equation <a href="#eq-pem-likelihood-general" class="quarto-xref"><span>18.16</span></a>, since <span class="math inline">\(t_{ij}\)</span> is a constant and does not depend on the parameters of interest (here <span class="math inline">\(h_j\)</span>). This implies that we can estimate a model with piecewise constant hazards by optimizing the Poisson likelihood <a href="#eq-pem-poisson-likelihood" class="quarto-xref"><span>18.17</span></a>. The <span class="math inline">\(t_{ij}\)</span> term enters as an offset term <span class="math inline">\(\log(t_{ij})\)</span> in the Poisson regression model.</p>
<p>More generally, in the presence of features <span class="math inline">\(\mathbf{x}_i\)</span>, assume <span class="math inline">\(\delta_{ij}|\mathbf{x}_i \stackrel{iid}{\sim} \text{Poisson}(\mu_{ij})\)</span>, where <span class="math inline">\(\mu_{ij} = h_{ij} t_{ij}\)</span> is the expected number of events in interval <span class="math inline">\(j\)</span> given features <span class="math inline">\(\mathbf{x}_i\)</span> and <span class="math inline">\(h_{ij} = g(t_j, \mathbf{x}_i)\)</span> is the hazard rate in interval <span class="math inline">\(j\)</span> given features <span class="math inline">\(\mathbf{x}_i\)</span>. This can be estimated by fitting a Poisson regression model with log-link to the transformed data set <!--  --> <span id="eq-pem-data"><span class="math display">\[\mathcal{D}_{\mathcal{A}} = \{(\delta_{ij}, t_{ij}, t_j, \mathbf{x}_{ij})\}_{i=1,\ldots,n; j=1,\ldots,J_i}, \tag{18.18}\]</span></span> <!--  --> where the model specification is <!--  --> <span id="eq-pem-model"><span class="math display">\[\log(\mathbb{E}[\Delta_{ij}]) = \log(h_{ij}) + \log(t_{ij}), \tag{18.19}\]</span></span> <!--  --> where <span class="math inline">\(\log(h_{ij}) = g(\mathbf{x}_i, t_j)\)</span> is the interval and feature specific hazard rate, <span class="math inline">\(g\)</span> is a function learned by the model of choice and <span class="math inline">\(\log(t_{ij})\)</span> is included as an offset term in the Poisson likelihood/Loss function.</p>
<p>Importantly, in contrast to the discrete time reductions in Section <a href="#sec-discrete-time-reduction" class="quarto-xref"><span>Section 18.2</span></a>, the piecewise exponential model likelihood has no information loss regarding the exact time-to-event by including the <span class="math inline">\(t_{ij}\)</span> terms (<a href="#eq-time-at-risk" class="quarto-xref"><span>18.3</span></a>) and estimates continuous time hazards rather than discrete time hazards.</p>
<!-- TODO: The model predicts $\hat{h}_{ij}$ and we need to transform this to $\hat{S}_{ij}$ if we want S(t) predictions -->
<section id="example-poisson-regression" class="level3" data-number="18.4.1">
<h3 data-number="18.4.1" class="anchored" data-anchor-id="example-poisson-regression"><span class="header-section-number">18.4.1</span> Example: Poisson Regression</h3>
<p>To illustrate the piecewise constant hazards approach, we once again consider the tumor data set. We partition the follow-up time into <span class="math inline">\(J = 100\)</span> equidistant intervals. We then fit a Poisson regression model with interaction between interval and complications to allow for separate baseline hazards for each complications group:</p>
<!--  -->
<p><span id="eq-pem-model-interaction"><span class="math display">\[\log(\mu_{ij}) = \log(\mathbb{E}[\Delta_{ij}]) = \underbrace{\beta_{0j} + \beta_{1j}x_{i1}}_{\log(h_{ij})} + \log(t_{ij}), \tag{18.20}\]</span></span> <!--  --> where <span class="math inline">\(x_{i1} = \mathbb{I}(\text{complications}_i = \text{"yes"})\)</span>, <span class="math inline">\(\beta_{0j}\)</span> are the interval-specific intercepts for the reference group (no complications), <span class="math inline">\(\beta_{1j}\)</span> are the deviations from the reference group for the complications group (as in <a href="#eq-discrete-time-glm-interaction" class="quarto-xref"><span>18.12</span></a>, this is estimated as an interaction model using reference coded categorical features for interval and complications), and <span class="math inline">\(\log(t_{ij})\)</span> enters as offset term.</p>
<!-- TODO: show estimated hazards? -->
<p>Figure <a href="#fig-pem-interaction" class="quarto-xref">Figure&nbsp;<span>18.6</span></a> shows the estimated survival probabilities from the piecewise exponential model (dashed lines) together with the Kaplan-Meier estimates (solid lines) for comparison. The piecewise exponential model provides an excellent fit to the data, closely approximating the Kaplan-Meier estimates. This demonstrates that the piecewise constant hazards approach can effectively estimate the survival distribution when using a sufficient number of intervals.</p>
<div id="fig-pem-interaction" class="quarto-float quarto-figure quarto-figure-center anchored" alt="Single plot showing survival curves for patients with and without complications. Kaplan-Meier estimates are shown as solid lines and piecewise exponential model estimates are shown as dashed lines, both colored by complications status.">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pem-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/reductions/pem-complications-interaction.png" class="img-fluid figure-img" alt="Single plot showing survival curves for patients with and without complications. Kaplan-Meier estimates are shown as solid lines and piecewise exponential model estimates are shown as dashed lines, both colored by complications status.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pem-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18.6: Comparison of survival probability estimates using the piecewise exponential model (Poisson regression) and the Kaplan-Meier estimator, for patients with and without complications.
</figcaption>
</figure>
</div>
</section>
</section>
<section id="sec-choice-of-interval-boundaries" class="level2" data-number="18.5">
<h2 data-number="18.5" class="anchored" data-anchor-id="sec-choice-of-interval-boundaries"><span class="header-section-number">18.5</span> Choice of Interval Boundaries</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-craigreviewsurvival" class="csl-entry" role="listitem">
Craig, Erin, Chenyang Zhong, and Robert Tibshirani. 2025. <span>“A Review of Survival Stacking: A Method to Cast Survival Regression Analysis as a Classification Problem.”</span> <em>The International Journal of Biostatistics</em> 21 (1): 37–51. <a href="https://doi.org/10.1515/ijb-2022-0055">https://doi.org/10.1515/ijb-2022-0055</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./P4C21_pseudo.html" class="pagination-link" aria-label="Pseudo-value regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Pseudo-value regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./P4C24_eha.html" class="pagination-link" aria-label="Reductions for Event-History Analysis">
        <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Reductions for Event-History Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © Raphael Sonabend, Andreas Bender.</p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://www.mlsabook.com">Website</a> | <a href="https://github.com/mlsa-book/MLSA">GitHub</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mlsa-book/MLSA/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/mlsa-book/MLSA/edit/main/book/P4C22_partition-based-reduction.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li><li><a href="https://github.com/mlsa-book/MLSA/blob/main/book/P4C22_partition-based-reduction.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




</body></html>